[
  {
    "objectID": "tutorials/subfir3_covars.html",
    "href": "tutorials/subfir3_covars.html",
    "title": "Subalpine fir distribution - Part 3",
    "section": "",
    "text": "Objectives:\n\nDownload bioclimate data (tiles) from Worldclim\nClip the tiles to KDTT study area\nExtract bioclimate data using random subalpine fir location"
  },
  {
    "objectID": "tutorials/subfir3_covars.html#introduction",
    "href": "tutorials/subfir3_covars.html#introduction",
    "title": "Subalpine fir distribution - Part 3",
    "section": "",
    "text": "Objectives:\n\nDownload bioclimate data (tiles) from Worldclim\nClip the tiles to KDTT study area\nExtract bioclimate data using random subalpine fir location"
  },
  {
    "objectID": "tutorials/subfir3_covars.html#methods",
    "href": "tutorials/subfir3_covars.html#methods",
    "title": "Subalpine fir distribution - Part 3",
    "section": "Methods",
    "text": "Methods\n\nLoad required libraries\n\nlibrary(sf)\nlibrary(tmap)\nlibrary(dplyr)\nlibrary(terra)\nlibrary(tmaptools)\nlibrary(geodata)\nset.seed(123)\n\n\n\nView study area\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\n\n\n\n\n\n\n\n\n\nDownload and prepare bioclimate data\nWe will use the worldclim_tile function in the geodata package to download a standard set of 19 bioclimatic variables from the Worlclim website. We will select the highest resolution data available (~1 km2) representing an average for the years 1970-2000 (climate normal). AdaptWest also provides a similar set of datasets, the disadvantage being that they have to be downloaded manually.\nThe KDTT study area requires that I download two tiles of data.\n\nbnd4326 &lt;- st_transform(bnd, 4326)\n# Uncomment next 2 lines to download climate data from Worlclim\nd1 &lt;- worldclim_tile(var='bio', lon=-128, lat=59, path='../data_raw/tmp')\nd2 &lt;- worldclim_tile(var='bio', lon=-128, lat=61, path='../data_raw/tmp')\n\n\n\nRead and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\nt1 &lt;- rast('../data_raw/tile_14_wc2.1_30s_bio.tif')\nnames(t1)\n\n [1] \"tile_14_wc2.1_30s_bio_1\"  \"tile_14_wc2.1_30s_bio_2\" \n [3] \"tile_14_wc2.1_30s_bio_3\"  \"tile_14_wc2.1_30s_bio_4\" \n [5] \"tile_14_wc2.1_30s_bio_5\"  \"tile_14_wc2.1_30s_bio_6\" \n [7] \"tile_14_wc2.1_30s_bio_7\"  \"tile_14_wc2.1_30s_bio_8\" \n [9] \"tile_14_wc2.1_30s_bio_9\"  \"tile_14_wc2.1_30s_bio_10\"\n[11] \"tile_14_wc2.1_30s_bio_11\" \"tile_14_wc2.1_30s_bio_12\"\n[13] \"tile_14_wc2.1_30s_bio_13\" \"tile_14_wc2.1_30s_bio_14\"\n[15] \"tile_14_wc2.1_30s_bio_15\" \"tile_14_wc2.1_30s_bio_16\"\n[17] \"tile_14_wc2.1_30s_bio_17\" \"tile_14_wc2.1_30s_bio_18\"\n[19] \"tile_14_wc2.1_30s_bio_19\"\n\nnames(t1) &lt;- paste0(\"bio\", c(1, 10:19, 2:9))\nnames(t1)\n\n [1] \"bio1\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[10] \"bio18\" \"bio19\" \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[19] \"bio9\" \n\nt2 &lt;- rast('../data_raw/tile_2_wc2.1_30s_bio.tif')\nnames(t2) &lt;- paste0(\"bio\", c(1, 10:19, 2:9))\nnames(t2)\n\n [1] \"bio1\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[10] \"bio18\" \"bio19\" \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[19] \"bio9\" \n\n\n\n\nClip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\nt1_crop &lt;- crop(t1, vect(bnd4326))\nt1_msk &lt;- mask(t1_crop, vect(bnd4326))\nt2_crop &lt;- crop(t2, vect(bnd4326))\nt2_msk &lt;- mask(t2_crop, vect(bnd4326))\ntt &lt;- merge(t1_msk, t2_msk)\ntt\n\nclass       : SpatRaster \ndimensions  : 848, 1384, 19  (nrow, ncol, nlyr)\nresolution  : 0.008333333, 0.008333333  (x, y)\nextent      : -135.175, -123.6417, 56.75, 63.81667  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsource(s)   : memory\nvarname     : tile_14_wc2.1_30s_bio \nnames       :      bio1,     bio10, bio11, bio12, bio13, bio14, ... \nmin values  : -11.83333,  1.283333, -24.8,   254,    51,     4, ... \nmax values  :   0.81250, 15.533333, -12.4,   829,   133,    36, ... \n\n#writeRaster(tt, 'data/bio.tif', overwrite=TRUE)\n\n\n\nView some of the merged raster layers\nWe will take a look at two of the layers, temperature and precipitation.\nTemperature\nbio5 = Max Temperature of Warmest Month\n\npal &lt;- get_brewer_pal(\"-RdYlBu\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio5\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=pal), \n    col.legend = tm_legend(title = \"Temperature (*C)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\n\n\n\n\n\n\n\n\nPrecipitation\nbio13 = Precipitation of Wettest Month\n\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\n\n\n\n\n\n\n\n\n\n\nExtract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nabla_pts &lt;- st_read('data/kdtt.gpkg', 'abla') %&gt;%\n  st_transform(4326)\n\nReading layer `abla' from data source \n  `C:\\Users\\PIVER37\\Documents\\github\\beaconsproject\\coding\\tutorials\\data\\kdtt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\n\nabla_bio &lt;- extract(tt, vect(abla_pts))\nabla_pts_bio &lt;- bind_cols(abla_pts, abla_bio)\nabla_pts_bio\n\nSimple feature collection with 1965 features and 22 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -135.1869 ymin: 56.71846 xmax: -123.605 ymax: 63.79814\nGeodetic CRS:  WGS 84\nFirst 10 features:\n   Occurrence PresenceAbsence ID       bio1     bio10     bio11 bio12 bio13\n1           0          Absent  1 -1.9625000 13.833333 -19.31667   497    95\n2           0          Absent  2 -2.3541667 10.900000 -16.20000   529    87\n3           0          Absent  3 -2.2750001 12.950000 -19.73333   453    67\n4           0          Absent  4 -5.7375002  8.599999 -18.68333   368    69\n5           0          Absent  5 -0.4041666 12.183333 -14.05000   490    67\n6           0          Absent  6 -3.0874999 13.316667 -21.28333   481    78\n7           0          Absent  7 -4.3833332  7.150000 -15.13333   673    89\n8           0          Absent  8 -7.5625000  7.616667 -21.06667   601    95\n9           0          Absent  9 -3.8625000 11.683333 -20.98333   499    73\n10          0          Absent 10 -3.8333333 11.066667 -19.33333   291    56\n   bio14    bio15 bio16 bio17 bio18 bio19     bio2     bio3      bio4 bio5\n1     18 59.72225   236    58   236    65 11.37500 23.84696 1361.7103 21.4\n2     21 44.35683   219    70   219   100 11.67500 27.79762 1110.5802 18.4\n3     18 37.28563   173    64   173    92 12.03333 24.65847 1338.5551 20.9\n4     14 54.75156   168    47   168    55 11.47500 26.87354 1132.0378 16.3\n5     13 36.72025   174    60   174   123 11.35833 27.70325 1067.7471 19.6\n6     21 42.57211   198    69   198    86 12.25833 23.89539 1419.1597 21.7\n7     21 32.92192   236    98   236   151 10.55000 28.98352  917.8218 14.3\n8     29 43.76863   251    91   251    98 10.77500 24.54442 1199.4926 15.3\n9     20 39.83319   194    68   194    91 12.02500 24.74280 1337.6661 19.5\n10     9 57.27034   135    32   135    44 13.36667 28.25934 1251.1655 19.7\n    bio6 bio7      bio8       bio9                       geom\n1  -26.3 47.7 13.833333  -9.216666 POINT (-124.4427 60.07953)\n2  -23.6 42.0 10.900000  -8.283334 POINT (-126.4029 59.11991)\n3  -27.9 48.8 12.950000  -8.433333   POINT (-127.2625 59.829)\n4  -26.4 42.7  8.599999 -12.183333 POINT (-132.6516 62.73448)\n5  -21.4 41.0 12.183333  -5.616667  POINT (-126.226 57.62838)\n6  -29.6 51.3 13.316667  -9.750000  POINT (-126.0417 60.4285)\n7  -22.1 36.4  7.150000  -9.800000  POINT (-126.8268 57.8491)\n8  -28.6 43.9  7.616667 -14.716667 POINT (-127.1326 62.11206)\n9  -29.1 48.6 11.683333 -10.333334 POINT (-128.3891 60.67085)\n10 -27.6 47.3 11.066667 -10.183333 POINT (-132.2993 61.79676)\n\n\n\n\nMap bioclimate values at points\n\ntmap_mode(\"view\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla_pts_bio) + tm_dots(fill='bio3', size=0.3,\n    fill.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\nMap bioclimate raster with presence/absence\n\ntmap_mode(\"view\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla_pts_bio) + tm_dots(fill='PresenceAbsence', size=0.3,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\nSplit sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\n#set.seed(123)\nabla_train &lt;- abla_pts_bio %&gt;%\n  sample_frac(size = 0.7)\ntable(abla_train$PresenceAbsence)\n\n\n Absent Present \n    702     674 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ntable(abla_val$PresenceAbsence)\n\n&lt; table of extent 0 &gt;"
  },
  {
    "objectID": "tutorials/subfir1_gbif.html",
    "href": "tutorials/subfir1_gbif.html",
    "title": "Subalpine fir distribution - Part 1",
    "section": "",
    "text": "Objectives\n\nTo read and view a map of your study area\nTo download species data from GBIF\nTo map the distribution of species in your study area\n\nYou will first need to make sure you have the R packages listed below, otherwise you will need to install them using the install.packages function:\n\n# Uncomment the next line to install the packages\n#install.packages(c('sf', 'tmap', 'dplyr', 'terra', 'tmaptools', 'geodata', 'mapview'))\n\n\nlibrary(sf)\n\nLinking to GEOS 3.11.2, GDAL 3.7.2, PROJ 9.3.0; sf_use_s2() is TRUE\n\nlibrary(tmap)\n\n\nAttaching package: 'tmap'\n\n\nThe following object is masked from 'package:datasets':\n\n    rivers\n\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(terra)\n\nterra 1.7.65\n\nlibrary(tmaptools)\nlibrary(geodata)\nlibrary(mapview)\n\n\n\nStudy area\nThe example study area is the Kaska Dene Traditional Territory.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nplot(bnd)\n\n\n\n\n\n\n\n\n\nPlot geometry only\n\nplot(st_geometry(bnd))\n\n\n\n\n\n\n\n\n\n\nPlot using the tmap package\n\ntmap_mode(\"plot\")\n\ntmap mode set to 'plot'\n\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\n\n\n\n\n\n\n\n\n\nAdd a basemap\n\ntm_basemap(server = \"Esri.WorldTopoMap\") +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\nSpatRaster object downsampled to 1087 by 921 cells.\n\n\n\n\n\n\n\n\n\n\n\nView interactive map\n\nmapview(bnd)\n\n\n\n\n\n\n\n\nDistribution data\nSince I don’t have any of my own data, I will try to acquire existing subalpine fir location data. Sources of species distribution data include the Global Biodiversity Information Facility (GBIF). The geodata includes a function to download data from GBIF.\n\n# Specify genus and species for species of interest (e.g., alces alces for moose)\ngenus = 'abies'\nspecies = 'lasiocarpa'\n\n# Buffer by 100k (optional but may result in additional nearby data)\nbnd100 &lt;- st_buffer(bnd, 100000)\n\n# Download GBIF data and convert to sf point object\ng &lt;- sp_occurrence(genus, species, geo=TRUE, end=2500)\n\n2500 records found\n\n\n0-300-600-900-1200-1500-1800-2100-2400-2500\n2500 records downloaded\n\ngg &lt;- select(g, lon, lat, year) %&gt;%\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs=4326) %&gt;%\n  st_transform(3578)\ngg\n\nSimple feature collection with 2500 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 163800.3 ymin: -1911086 xmax: 4047836 ymax: 7039517\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n   year                  geometry\n1  2024  POINT (2851010 -1046781)\n2  2024  POINT (2328168 -1201267)\n3  2024  POINT (163800.3 1082496)\n4  2024 POINT (1473910 -65676.52)\n5  2024 POINT (1374561 -513152.5)\n6  2024 POINT (1475957 -66714.07)\n7  2024  POINT (1475531 -66591.9)\n8  2024  POINT (2834823 -1122412)\n9  2024  POINT (2983006 -1541952)\n10 2024  POINT (2319437 -1519870)\n\n\n\nMap download points\n\nmapview(bnd100, alpha.regions=0, lwd=1) + \n  mapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(gg, cex=1, col='red', col.regions='red', legend=NULL)\n\n\n\n\n\n\n\nSelect subset of data\n\n# Select points that are within the buffered study region\ngg_sub &lt;- gg[bnd100,]\ngg_sub\n\nSimple feature collection with 38 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 332577.2 ymin: 321959.5 xmax: 1086028 ymax: 851177.9\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n    year                  geometry\n266 2023 POINT (813462.6 321959.5)\n531 2023 POINT (612514.9 528531.3)\n532 2023 POINT (613483.9 529252.6)\n534 2023   POINT (614220.3 527707)\n536 2023   POINT (612667.4 528039)\n540 2023 POINT (612892.2 527972.3)\n541 2023 POINT (613465.1 529436.4)\n542 2023 POINT (636082.8 332375.1)\n545 2023 POINT (612564.2 528012.9)\n546 2023 POINT (613149.3 526483.9)\n\n\n\n\nPlot subalpine fir locations\n\n# Plot AOI + points\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n  tm_shape(bnd100) + tm_polygons(color='black', fill_alpha=0, lwd=1) +\n    tm_shape(gg_sub) + tm_dots()\n\nSpatRaster object downsampled to 1087 by 921 cells.\n\n\n\n\n\n\n\n\n\n\n\nPlot subalpine fir locations (interactive)\n\nlibrary(mapview)\nmapview(bnd100, alpha.regions=0, lwd=1) + \n  mapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(gg_sub, cex=4, col='red', col.regions='red', legend=NULL)"
  },
  {
    "objectID": "resources.html",
    "href": "resources.html",
    "title": "Resources",
    "section": "",
    "text": "Data wrangling, exploration, and analysis\n\nSTAT 545 @ UBC\nSTAT 545 (original course)\n\nMovement data\n\nhttps://terpconnect.umd.edu/~egurarie/teaching/SpatialModelling_AKTWS2018/index.html\n\nGit and Github\n\nhttps://happygitwithr.com/\n\n\n\n\n\nhttps://quarto.org/ (the latest iteration of markdown - very flexible)\nhttps://bookdown.org/pdr_higgins/rmrwr/introduction-to-r-markdown.html\n\nShiny apps\n\nhttps://mastering-shiny.org/index.html\nhttps://bookdown.org/pdr_higgins/rmrwr/a-gentle-introduction-to-shiny.html\n\nGeocomputation\n\nhttps://geocompx.org/\n\n\n\n\n\nPopovic et al. 2024. Four principles for improved statistical ecology.\nZuur et al. 2010\nZuur et al. 2016"
  },
  {
    "objectID": "resources.html#key-papers",
    "href": "resources.html#key-papers",
    "title": "Resources",
    "section": "",
    "text": "Popovic et al. 2024. Four principles for improved statistical ecology.\nZuur et al. 2010\nZuur et al. 2016"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Coding Resources",
    "section": "",
    "text": "Quantitative Skills for Conservation Scientists\n\nPlanning - Internal use only\n\nObjectives: Learn quantitative skills to conduct a fully replicable analysis\n\nGit and Github\nMarkdown\nR and/or Python\nShiny apps\nStorymaps\n\nThe resources within these pages will help you to:\n\nCreate an individual Github repository to host your code and data and enable others to review and replicate your analysis\nConduct a complete analysis using your own dataset(s)\nCreate a group Github repository to organize useful resources e.g., bookmarks, online tutorials, tips, etc.\n\nSchedule:\nWeek 1 (2024-01-29)\n\nIndividual and group objectives\nCreate a provisional schedule\nInstall R/RStudio, Python/RStudio, or Colab\nCreate an account on Github and install git and GitHub Desktop\nhttps://rverse-tutorials.github.io/RWorkflow-NWFSC-2022/week1-introtogit.html\n\nWeek 2 (2024-02-05)\n\nZach to present his project\nMaegan to present his project = Subalpine fir tutorial - part 1\n\nWeek 3 (2024-02-12)\n\nCloning the �coding� repo\nSubalpine fir tutorial - part 2\nGabriel to present his project\n\nWeek 4 (2024-02-26)"
  },
  {
    "objectID": "tips/github.html",
    "href": "tips/github.html",
    "title": "Git and GitHub",
    "section": "",
    "text": "Create GitHub account\nCreate a repository\nInstall git\nConfigure git\nInstall GitHub Desktop\nClone repository to your computer\nMake some changes to your repository\nPush your changes back to GitHub"
  },
  {
    "objectID": "tips/github.html#getting-started-with-git-and-github",
    "href": "tips/github.html#getting-started-with-git-and-github",
    "title": "Git and GitHub",
    "section": "",
    "text": "Create GitHub account\nCreate a repository\nInstall git\nConfigure git\nInstall GitHub Desktop\nClone repository to your computer\nMake some changes to your repository\nPush your changes back to GitHub"
  },
  {
    "objectID": "tips/github.html#step-1.-create-a-github-account",
    "href": "tips/github.html#step-1.-create-a-github-account",
    "title": "Git and GitHub",
    "section": "Step 1. Create a GitHub account",
    "text": "Step 1. Create a GitHub account\nIf you don’t already have a GitHub account, go to GitHub.com and create one."
  },
  {
    "objectID": "tips/github.html#step-2.-create-a-repository-part-1",
    "href": "tips/github.html#step-2.-create-a-repository-part-1",
    "title": "Git and GitHub",
    "section": "Step 2. Create a repository (part 1)",
    "text": "Step 2. Create a repository (part 1)\nSign in to your GitHub account and create a new repository.\n\nmake it public\nadd a Readme.md file"
  },
  {
    "objectID": "tips/github.html#step-2.-create-a-repository-part-2",
    "href": "tips/github.html#step-2.-create-a-repository-part-2",
    "title": "Git and GitHub",
    "section": "Step 2. Create a repository (part 2)",
    "text": "Step 2. Create a repository (part 2)"
  },
  {
    "objectID": "tips/github.html#step-3.-install-git",
    "href": "tips/github.html#step-3.-install-git",
    "title": "Git and GitHub",
    "section": "Step 3. Install Git",
    "text": "Step 3. Install Git\nDownload and install from here git"
  },
  {
    "objectID": "tips/github.html#step-4.-configure-git-part-1",
    "href": "tips/github.html#step-4.-configure-git-part-1",
    "title": "Git and GitHub",
    "section": "Step 4. Configure git (part 1)",
    "text": "Step 4. Configure git (part 1)\nThe Git client needs to know who you are before you can start to use it.\n\nOpen your File Explorer\nRight click in any folder\nSelect “Git Bash here”"
  },
  {
    "objectID": "tips/github.html#step-4.-configure-git-part-2",
    "href": "tips/github.html#step-4.-configure-git-part-2",
    "title": "Git and GitHub",
    "section": "Step 4. Configure git (part 2)",
    "text": "Step 4. Configure git (part 2)"
  },
  {
    "objectID": "tips/github.html#step-4.-configure-git-part-3",
    "href": "tips/github.html#step-4.-configure-git-part-3",
    "title": "Git and GitHub",
    "section": "Step 4. Configure git (part 3)",
    "text": "Step 4. Configure git (part 3)\n\ngit config –global user.name “prvernier”\ngit config –global user.email “pierre.vernier@gmail.com”"
  },
  {
    "objectID": "tips/github.html#step-5.-install-github-desktop",
    "href": "tips/github.html#step-5.-install-github-desktop",
    "title": "Git and GitHub",
    "section": "Step 5. Install GitHub Desktop",
    "text": "Step 5. Install GitHub Desktop\nIf you’d rather not work at the command line with Git, you can download a GUI client such as GitHub Desktop.\n\nGitHub Desktop"
  },
  {
    "objectID": "tips/github.html#step-6.-clone-repository-to-your-computer",
    "href": "tips/github.html#step-6.-clone-repository-to-your-computer",
    "title": "Git and GitHub",
    "section": "Step 6. Clone repository to your computer",
    "text": "Step 6. Clone repository to your computer\n\nOpen GitHub Desktop and clone the repository you just created."
  },
  {
    "objectID": "tips/github.html#step-7.-make-some-changes-to-your-repository",
    "href": "tips/github.html#step-7.-make-some-changes-to-your-repository",
    "title": "Git and GitHub",
    "section": "Step 7. Make some changes to your repository",
    "text": "Step 7. Make some changes to your repository\n\nOpen your Readme.md file\nAdd some text and save it"
  },
  {
    "objectID": "tips/github.html#step-8.-push-your-changes-back-to-github",
    "href": "tips/github.html#step-8.-push-your-changes-back-to-github",
    "title": "Git and GitHub",
    "section": "Step 8. Push your changes back to GitHub",
    "text": "Step 8. Push your changes back to GitHub\n\nOpen GitHub Desktop\nAdd a comment\nCommit changes\nPush changes"
  },
  {
    "objectID": "tips/github.html#step-9.-helful-resources",
    "href": "tips/github.html#step-9.-helful-resources",
    "title": "Git and GitHub",
    "section": "Step 9. Helful resources",
    "text": "Step 9. Helful resources\nThere are many online resources online.\n\nDo a Google search e.g., “git and github primer”\nhappygitwithr (excellent one stop resource!)"
  },
  {
    "objectID": "tutorials/subfir2_raster.html",
    "href": "tutorials/subfir2_raster.html",
    "title": "Subalpine fir distribution - Part 2",
    "section": "",
    "text": "library(sf)\nlibrary(tmap)\nlibrary(dplyr)\nlibrary(terra)\nlibrary(tmaptools)\nlibrary(geodata)"
  },
  {
    "objectID": "tutorials/subfir2_raster.html#clip-tree-raster-data-to-study-area",
    "href": "tutorials/subfir2_raster.html#clip-tree-raster-data-to-study-area",
    "title": "Subalpine fir distribution - Part 2",
    "section": "Clip tree raster data to study area",
    "text": "Clip tree raster data to study area\n\ntrees &lt;- rast('data/tree_species.tif') #|&gt;\n  #crop(bnd) |&gt;\n  #mask(bnd)\nplot(trees)\n\n\n\n\n\n\n\n\n\nTree species codes\n\n# https://gee-community-catalog.org/projects/ca_species/\nspp &lt;- tibble(code=c(0,3,10,16,17,18,23,29), # these are the species codes in the raster\n  spp=c('na','Subalpine fir','White birch','Engelmann spruce','White spruce',\n    'Black spruce','Lodgepole pine','Trembling aspen'))\nspp\n\n# A tibble: 8 × 2\n   code spp             \n  &lt;dbl&gt; &lt;chr&gt;           \n1     0 na              \n2     3 Subalpine fir   \n3    10 White birch     \n4    16 Engelmann spruce\n5    17 White spruce    \n6    18 Black spruce    \n7    23 Lodgepole pine  \n8    29 Trembling aspen"
  },
  {
    "objectID": "tutorials/subfir2_raster.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0",
    "href": "tutorials/subfir2_raster.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0",
    "title": "Subalpine fir distribution - Part 2",
    "section": "Reclassify tree species map to subalpine fir = 1 and everything else = 0",
    "text": "Reclassify tree species map to subalpine fir = 1 and everything else = 0\n\nr_abla &lt;- classify(trees, rbind(c(-1,2,0),  c(2,3,1), c(4,30,0)))\n\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n\nplot(r_abla)"
  },
  {
    "objectID": "tutorials/subfir2_raster.html#create-subalpine-fir-datasets-using-random-sample-of-pixels",
    "href": "tutorials/subfir2_raster.html#create-subalpine-fir-datasets-using-random-sample-of-pixels",
    "title": "Subalpine fir distribution - Part 2",
    "section": "Create subalpine fir datasets using random sample of pixels",
    "text": "Create subalpine fir datasets using random sample of pixels\nTo do this we’re going to randomly sample around 1000 subalpine fir pixels and 1000 non subalpine fir pixels. We first set a random number seed so that we can replicate the sample. Without setting a seed, you would get a different random sample each time you ran the code segment. This could be useful if you wanted to generate a few hundred or few thousand samples in order to get a distribution of random samples.\n\n# Set random number seed\nset.seed(123)\n\n# Draw a stratified random sample of 1000 pixels\nabla &lt;- spatSample(r_abla, 1000, method='stratified', xy=TRUE, values=TRUE, na.rm=TRUE) |&gt; \n  st_as_sf(coords = c(\"x\", \"y\"), crs=3578) # convert to an \"sf\" object\nabla\n\nSimple feature collection with 1965 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     b1              geometry\n7584  0 POINT (948045 648495)\n4033  0 POINT (849675 530145)\n3084  0 POINT (793995 604275)\n6577  0 POINT (492255 915765)\n6519  0 POINT (876135 366465)\n147   0 POINT (855525 676935)\n454   0 POINT (838035 387435)\n7135  0 POINT (779775 858195)\n2536  0 POINT (724785 693075)\n6343  0 POINT (510585 811215)\n\n\nThe new variable is called “b1” and contains values of 0 (absent) and 1 (present). We’ll rename it to “Occurrence” and create a second variable with character values “present” and “absent”.\n\n# Rename b1 and create a second variable which is a \nabla &lt;- rename(abla, Occurrence=b1) |&gt;\n  mutate(PresenceAbsence=ifelse(Occurrence==1, \"Present\", \"Absent\"), b1=NULL)\nabla\n\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     Occurrence              geometry PresenceAbsence\n7584          0 POINT (948045 648495)          Absent\n4033          0 POINT (849675 530145)          Absent\n3084          0 POINT (793995 604275)          Absent\n6577          0 POINT (492255 915765)          Absent\n6519          0 POINT (876135 366465)          Absent\n147           0 POINT (855525 676935)          Absent\n454           0 POINT (838035 387435)          Absent\n7135          0 POINT (779775 858195)          Absent\n2536          0 POINT (724785 693075)          Absent\n6343          0 POINT (510585 811215)          Absent\n\n# Uncomment to save results to a geopackage\nst_write(abla, 'data/kdtt.gpkg', 'abla', delete_layer=T)\n\nDeleting layer `abla' using driver `GPKG'\nWriting layer `abla' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 2 fields and geometry type Point."
  },
  {
    "objectID": "tutorials/subfir2_raster.html#map-presence-absence-of-subalpine-fir",
    "href": "tutorials/subfir2_raster.html#map-presence-absence-of-subalpine-fir",
    "title": "Subalpine fir distribution - Part 2",
    "section": "Map presence-absence of subalpine fir",
    "text": "Map presence-absence of subalpine fir\n\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.3,\n  fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/subfir2_raster.html#map-presence-absence-interactive-mode",
    "href": "tutorials/subfir2_raster.html#map-presence-absence-interactive-mode",
    "title": "Subalpine fir distribution - Part 2",
    "section": "Map presence-absence (interactive mode)",
    "text": "Map presence-absence (interactive mode)\n\ntmap_mode(\"plot\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\n  tm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n    tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.3,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n    tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\n\nlibrary(mapview)\nmapview(bnd, alpha.regions=0, lwd=2) + \n  mapview(abla, zcol='PresenceAbsence', col.regions=c('red','blue'), cex=2)"
  },
  {
    "objectID": "resources.html#websites",
    "href": "resources.html#websites",
    "title": "Resources",
    "section": "",
    "text": "Data wrangling, exploration, and analysis\n\nSTAT 545 @ UBC\nSTAT 545 (original course)\n\nMovement data\n\nhttps://terpconnect.umd.edu/~egurarie/teaching/SpatialModelling_AKTWS2018/index.html\n\nGit and Github\n\nhttps://happygitwithr.com/"
  },
  {
    "objectID": "resources.html#markdown",
    "href": "resources.html#markdown",
    "title": "Resources",
    "section": "",
    "text": "https://quarto.org/ (the latest iteration of markdown - very flexible)\nhttps://bookdown.org/pdr_higgins/rmrwr/introduction-to-r-markdown.html\n\nShiny apps\n\nhttps://mastering-shiny.org/index.html\nhttps://bookdown.org/pdr_higgins/rmrwr/a-gentle-introduction-to-shiny.html\n\nGeocomputation\n\nhttps://geocompx.org/"
  },
  {
    "objectID": "tutorials/subfir4_model.html#introduction",
    "href": "tutorials/subfir4_model.html#introduction",
    "title": "Subalpine fir distribution - Part 4",
    "section": "",
    "text": "Objectives:\n\nExtract bioclimatic data using random subalpine fir location\nModel relationship between subalpine fir and bioclimatic variables\nMap predicted probability of occurrence of subalpine fir\nEvaluate the accuracy of the model"
  },
  {
    "objectID": "tutorials/subfir4_model.html#methods",
    "href": "tutorials/subfir4_model.html#methods",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Methods",
    "text": "Methods\nLoad required libraries\n\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(tmaptools)\nlibrary(tidyverse)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#view-study-area",
    "href": "tutorials/subfir4_model.html#view-study-area",
    "title": "Subalpine fir distribution - Part 4",
    "section": "View study area",
    "text": "View study area\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nbio &lt;- rast('data/bio.tif')\nabla &lt;- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %&gt;%\n  st_transform(4326)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#extract-bioclimate-data-using-points",
    "href": "tutorials/subfir4_model.html#extract-bioclimate-data-using-points",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Extract bioclimate data using points",
    "text": "Extract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nbio &lt;- rast('data/bio.tif')\nabla &lt;- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %&gt;%\n  st_transform(4326)\nabla_bio &lt;- terra::extract(bio, abla) %&gt;%\n  bind_cols(abla) %&gt;%\n  mutate(PresenceAbsence=NULL) %&gt;%\n  rename(abla=Occurrence) %&gt;%\n  as.data.frame()\nnames(abla_bio)\n\n [1] \"ID\"    \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[10] \"bio9\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[19] \"bio18\" \"bio19\" \"abla\"  \"geom\" \n\nhead(abla_bio)\n\n  ID       bio1      bio2      bio3 bio4 bio5 bio6     bio7 bio8 bio9 bio10\n1  1 -1.9625000 13.833333 -19.31667  497   95   18 59.72225  236   58   236\n2  2 -2.3541667 10.900000 -16.20000  529   87   21 44.35683  219   70   219\n3  3 -2.2750001 12.950000 -19.73333  453   67   18 37.28563  173   64   173\n4  4 -5.7375002  8.599999 -18.68333  368   69   14 54.75156  168   47   168\n5  5 -0.4041666 12.183333 -14.05000  490   67   13 36.72025  174   60   174\n6  6 -3.0874999 13.316667 -21.28333  481   78   21 42.57211  198   69   198\n  bio11    bio12    bio13    bio14 bio15 bio16 bio17     bio18      bio19 abla\n1    65 11.37500 23.84696 1361.710  21.4 -26.3  47.7 13.833333  -9.216666    0\n2   100 11.67500 27.79762 1110.580  18.4 -23.6  42.0 10.900000  -8.283334    0\n3    92 12.03333 24.65847 1338.555  20.9 -27.9  48.8 12.950000  -8.433333    0\n4    55 11.47500 26.87354 1132.038  16.3 -26.4  42.7  8.599999 -12.183333    0\n5   123 11.35833 27.70325 1067.747  19.6 -21.4  41.0 12.183333  -5.616667    0\n6    86 12.25833 23.89539 1419.160  21.7 -29.6  51.3 13.316667  -9.750000    0\n                        geom\n1 POINT (-124.4427 60.07953)\n2 POINT (-126.4029 59.11991)\n3   POINT (-127.2625 59.829)\n4 POINT (-132.6516 62.73448)\n5  POINT (-126.226 57.62838)\n6  POINT (-126.0417 60.4285)\n\nabla_bio_3578 &lt;- st_transform(st_as_sf(abla_bio), 3578)\nst_write(abla_bio_3578, 'data/kdtt.gpkg', 'bio', delete_layer=T)\n\nDeleting layer `bio' using driver `GPKG'\nWriting layer `bio' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 21 fields and geometry type Point.\n\n\n\n#tm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bio[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#split-sample-into-training-and-testing",
    "href": "tutorials/subfir4_model.html#split-sample-into-training-and-testing",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Split sample into training and testing",
    "text": "Split sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\nset.seed(123)\nabla_train &lt;- abla_bio %&gt;%\n  sample_frac(size = 0.7)\ncat(\"Training data (70%):\\n\")\n\nTraining data (70%):\n\ntable(abla_train$abla)\n\n\n  0   1 \n697 679 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ncat(\"\\n\\nTesting data (30%):\\n\")\n\n\n\nTesting data (30%):\n\ntable(abla_val$abla)\n\n\n  0   1 \n303 286"
  },
  {
    "objectID": "tutorials/subfir4_model.html#boosted-regression-tree",
    "href": "tutorials/subfir4_model.html#boosted-regression-tree",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Boosted regression tree",
    "text": "Boosted regression tree\nNow, we’re going to use our training data to develop a boosted regression tree model. You can easily find details about this type of model online and, eventually, in the resources pages of this coding website. The model will attempt to predict the probability of occurrence of subalpine fir as a function of one or more bioclimatic variable.\n\nabla_mod &lt;- gbm.step(data = abla_train, # data used to train model\n                     gbm.x = 2:20, # predictor variables\n                     gbm.y = 21, # response variable\n                     family = \"bernoulli\", # bernoulli is appropriate for occurrence data\n                     tree.complexity = 3,\n                     learning.rate = 0.01, \n                     bag.fraction = 0.5,\n                     plot.main = FALSE, \n                     verbose = FALSE, \n                     silent = TRUE)\nsaveRDS(abla_mod, 'data/abla_mod.rda')\nabla_imp &lt;- summary(abla_mod, plotit = FALSE)\ncat('Relative importance of bioclimatic variables:\\n')\n\nRelative importance of bioclimatic variables:\n\nabla_imp\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\nsummary(abla_mod)\n\n\n\n\n\n\n\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\n\nTop four variables:\n\nbio14 - Precipitation of Driest Month\nbio2 - Mean Diurnal Range (Mean of monthly max temp - min temp)\nbio11 - Mean Temperature of Coldest Quarter\nbio15 - Precipitation Seasonality (Coefficient of Variation)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#diagnostic-plots",
    "href": "tutorials/subfir4_model.html#diagnostic-plots",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Diagnostic plots",
    "text": "Diagnostic plots\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))"
  },
  {
    "objectID": "tutorials/subfir4_model.html#use-model-to-predict-values-at-all-pixels",
    "href": "tutorials/subfir4_model.html#use-model-to-predict-values-at-all-pixels",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Use model to predict values at all pixels",
    "text": "Use model to predict values at all pixels\n\nabla_cur &lt;- predict(object = bio, \n                    model = abla_mod, \n                    type = \"response\", \n                    na.rm = TRUE)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#predicted-probability-map",
    "href": "tutorials/subfir4_model.html#predicted-probability-map",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted probability map",
    "text": "Predicted probability map\nWe can now map the predicted probability of occurrence of subalpine fir across our study area.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#accuracy-assessment",
    "href": "tutorials/subfir4_model.html#accuracy-assessment",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Accuracy Assessment",
    "text": "Accuracy Assessment\nAn important step in statistical modelling is to evaluate the accuracy of the models. Ideally, we would use spatially and temporally independent data. However, this is rarely possible or affordable. Instead, we can use our hold-out or testing dataset to evaluate the predictive accuracy of our model. The code below creates a data frame from the observed and predicted data that will be used to calculate and plot a measure of predicted accuracy known as the Area under the receiver operating characteristics (ROC) curve. We can ignore the code for now.\n\nabla_pred &lt;- predict(abla_mod, \n                     newdata = abla_val,\n                     type = \"response\")\nabla_predobs &lt;- prediction(abla_pred, abla_val$abla)\nabla_roc = performance(abla_predobs, \n                       measure = \"tpr\", \n                       x.measure = \"fpr\")\nabla_fpr &lt;- slot(abla_roc, \"x.values\")[[1]]\nabla_tpr &lt;- slot(abla_roc, \"y.values\")[[1]]\nabla_aucplot &lt;- data.frame(abla_fpr, abla_tpr)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "href": "tutorials/subfir4_model.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Area under the receiver operating characteristics (ROC) curve",
    "text": "Area under the receiver operating characteristics (ROC) curve\nArea under the receiver operating characteristics (ROC) curve for predictions of subalpine fir occurrence based on WorldClim bioclimatic indices. We now use the table of observed and predicted observations to plot the ROC curve. If our model had no predictive capability, the curve would be a diagonal straight line. Curves that increasingly concave indicate higher accuracy.\n\nggplot(data = abla_aucplot) +\n  geom_line(aes(x = abla_fpr,\n                y = abla_tpr),\n            col = \"red\") +\n  labs(x = \"False Positive Rate\", \n       y = \"True Positive Rate\") +\n  geom_abline(slope = 1, intercept = 0) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/subfir4_model.html#plot-multiple-curves",
    "href": "tutorials/subfir4_model.html#plot-multiple-curves",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Plot multiple curves",
    "text": "Plot multiple curves\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/subfir4_model.html#roc-value",
    "href": "tutorials/subfir4_model.html#roc-value",
    "title": "Subalpine fir distribution - Part 4",
    "section": "ROC value",
    "text": "ROC value\nValues for the ROC curve range from 0 to 1, with values of 1 indicating perfect accuracy. Values of 0.5 indicate a random model, no better than the mean value of the occurrence data.\n\nabla_aucval &lt;- performance(abla_predobs, measure = \"auc\")\nslot(abla_aucval, \"y.values\")[[1]]\n\n[1] 0.9031249"
  },
  {
    "objectID": "tutorials/subfir4_model.html",
    "href": "tutorials/subfir4_model.html",
    "title": "Subalpine fir distribution - Part 4",
    "section": "",
    "text": "Objectives:\n\nExtract bioclimatic data using random subalpine fir location\nModel relationship between subalpine fir and bioclimatic variables\nMap predicted probability of occurrence of subalpine fir\nEvaluate the accuracy of the model"
  },
  {
    "objectID": "tutorials/subfir5_proj.html",
    "href": "tutorials/subfir5_proj.html",
    "title": "Climate Change Projections",
    "section": "",
    "text": "Climate Change Projections"
  },
  {
    "objectID": "tutorials/occurrence.html",
    "href": "tutorials/occurrence.html",
    "title": "Species distribution modelling",
    "section": "",
    "text": "This is a five part minimalist tutorial on modelling the current and future distribution of subalpine fir in the southeast Yukon and northcentral BC.\nFirst, we’re going to load a bunch of packages that will be used throughout the tutorial.\n\n\nYou will first need to make sure you have the R packages listed below, otherwise you will need to install them using the install.packages function:\n\n# Uncomment the next line to install the packages\n#install.packages(c('sf', 'tmap', 'dplyr', 'terra', 'tmaptools', 'geodata', 'mapview'))\n\n\n\n\n\n# Load required packages\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(geodata)\nlibrary(ggplot2)\nlibrary(mapview)\nlibrary(tmaptools)\nlibrary(tidyverse)\nsource('rasterdf.R')"
  },
  {
    "objectID": "tutorials/occurrence.html#clip-tree-raster-data-to-study-area",
    "href": "tutorials/occurrence.html#clip-tree-raster-data-to-study-area",
    "title": "Species distribution modelling",
    "section": "Clip tree raster data to study area",
    "text": "Clip tree raster data to study area\n\ntrees &lt;- rast('data/tree_species.tif') #|&gt;\n  #crop(bnd) |&gt;\n  #mask(bnd)\nplot(trees)\n\n\n\n\n\n\n\n\n\nTree species codes\n\n# https://gee-community-catalog.org/projects/ca_species/\nspp &lt;- tibble(code=c(0,3,10,16,17,18,23,29), # these are the species codes in the raster\n  spp=c('na','Subalpine fir','White birch','Engelmann spruce','White spruce',\n    'Black spruce','Lodgepole pine','Trembling aspen'))\nspp\n\n# A tibble: 8 × 2\n   code spp             \n  &lt;dbl&gt; &lt;chr&gt;           \n1     0 na              \n2     3 Subalpine fir   \n3    10 White birch     \n4    16 Engelmann spruce\n5    17 White spruce    \n6    18 Black spruce    \n7    23 Lodgepole pine  \n8    29 Trembling aspen"
  },
  {
    "objectID": "tutorials/occurrence.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0",
    "href": "tutorials/occurrence.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0",
    "title": "Species distribution modelling",
    "section": "Reclassify tree species map to subalpine fir = 1 and everything else = 0",
    "text": "Reclassify tree species map to subalpine fir = 1 and everything else = 0\n\nr_abla &lt;- classify(trees, rbind(c(-1,2,0),  c(2,3,1), c(4,30,0)))\n\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n\nplot(r_abla)\n\n\n\n\n\n\n\n\n\nRandom sample of tree pixels\nTo do this we’re going to randomly sample around 1000 subalpine fir pixels and 1000 non subalpine fir pixels. We first set a random number seed so that we can replicate the sample. Without setting a seed, you would get a different random sample each time you ran the code segment. This could be useful if you wanted to generate a few hundred or few thousand samples in order to get a distribution of random samples.\n\n# Set random number seed\nset.seed(123)\n\n# Draw a stratified random sample of 1000 pixels\nabla &lt;- spatSample(r_abla, 1000, method='stratified', xy=TRUE, values=TRUE, na.rm=TRUE) |&gt; \n  st_as_sf(coords = c(\"x\", \"y\"), crs=3578) # convert to an \"sf\" object\nabla\n\nSimple feature collection with 1965 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     b1              geometry\n7584  0 POINT (948045 648495)\n4033  0 POINT (849675 530145)\n3084  0 POINT (793995 604275)\n6577  0 POINT (492255 915765)\n6519  0 POINT (876135 366465)\n147   0 POINT (855525 676935)\n454   0 POINT (838035 387435)\n7135  0 POINT (779775 858195)\n2536  0 POINT (724785 693075)\n6343  0 POINT (510585 811215)\n\n\nThe new variable is called “b1” and contains values of 0 (absent) and 1 (present). We’ll rename it to “Occurrence” and create a second variable with character values “present” and “absent”.\n\n# Rename b1 and create a second variable which is a \nabla &lt;- rename(abla, Occurrence=b1) |&gt;\n  mutate(PresenceAbsence=ifelse(Occurrence==1, \"Present\", \"Absent\"), b1=NULL)\nabla\n\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     Occurrence              geometry PresenceAbsence\n7584          0 POINT (948045 648495)          Absent\n4033          0 POINT (849675 530145)          Absent\n3084          0 POINT (793995 604275)          Absent\n6577          0 POINT (492255 915765)          Absent\n6519          0 POINT (876135 366465)          Absent\n147           0 POINT (855525 676935)          Absent\n454           0 POINT (838035 387435)          Absent\n7135          0 POINT (779775 858195)          Absent\n2536          0 POINT (724785 693075)          Absent\n6343          0 POINT (510585 811215)          Absent\n\n# Uncomment to save results to a geopackage\nst_write(abla, 'data/kdtt.gpkg', 'abla', delete_layer=T)\n\nDeleting layer `abla' using driver `GPKG'\nWriting layer `abla' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 2 fields and geometry type Point."
  },
  {
    "objectID": "tutorials/occurrence.html#create-subalpine-fir-datasets-using-random-sample-of-pixels",
    "href": "tutorials/occurrence.html#create-subalpine-fir-datasets-using-random-sample-of-pixels",
    "title": "Current and future subalpine fir distribution",
    "section": "Create subalpine fir datasets using random sample of pixels",
    "text": "Create subalpine fir datasets using random sample of pixels\nTo do this we’re going to randomly sample around 1000 subalpine fir pixels and 1000 non subalpine fir pixels. We first set a random number seed so that we can replicate the sample. Without setting a seed, you would get a different random sample each time you ran the code segment. This could be useful if you wanted to generate a few hundred or few thousand samples in order to get a distribution of random samples.\n\n# Set random number seed\nset.seed(123)\n\n# Draw a stratified random sample of 1000 pixels\nabla &lt;- spatSample(r_abla, 1000, method='stratified', xy=TRUE, values=TRUE, na.rm=TRUE) |&gt; \n  st_as_sf(coords = c(\"x\", \"y\"), crs=3578) # convert to an \"sf\" object\nabla\n\nSimple feature collection with 1965 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     b1              geometry\n7584  0 POINT (948045 648495)\n4033  0 POINT (849675 530145)\n3084  0 POINT (793995 604275)\n6577  0 POINT (492255 915765)\n6519  0 POINT (876135 366465)\n147   0 POINT (855525 676935)\n454   0 POINT (838035 387435)\n7135  0 POINT (779775 858195)\n2536  0 POINT (724785 693075)\n6343  0 POINT (510585 811215)\n\n\nThe new variable is called “b1” and contains values of 0 (absent) and 1 (present). We’ll rename it to “Occurrence” and create a second variable with character values “present” and “absent”.\n\n# Rename b1 and create a second variable which is a \nabla &lt;- rename(abla, Occurrence=b1) |&gt;\n  mutate(PresenceAbsence=ifelse(Occurrence==1, \"Present\", \"Absent\"), b1=NULL)\nabla\n\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     Occurrence              geometry PresenceAbsence\n7584          0 POINT (948045 648495)          Absent\n4033          0 POINT (849675 530145)          Absent\n3084          0 POINT (793995 604275)          Absent\n6577          0 POINT (492255 915765)          Absent\n6519          0 POINT (876135 366465)          Absent\n147           0 POINT (855525 676935)          Absent\n454           0 POINT (838035 387435)          Absent\n7135          0 POINT (779775 858195)          Absent\n2536          0 POINT (724785 693075)          Absent\n6343          0 POINT (510585 811215)          Absent\n\n# Uncomment to save results to a geopackage\nst_write(abla, 'data/kdtt.gpkg', 'abla', delete_layer=T)\n\nDeleting layer `abla' using driver `GPKG'\nWriting layer `abla' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 2 fields and geometry type Point."
  },
  {
    "objectID": "tutorials/occurrence.html#map-presence-absence-of-subalpine-fir",
    "href": "tutorials/occurrence.html#map-presence-absence-of-subalpine-fir",
    "title": "Species distribution modelling",
    "section": "Map presence-absence of subalpine fir",
    "text": "Map presence-absence of subalpine fir\nLet’s view the results as a static map.\n\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.3,\n  fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/occurrence.html#map-presence-absence-interactive-mode",
    "href": "tutorials/occurrence.html#map-presence-absence-interactive-mode",
    "title": "Species distribution modelling",
    "section": "Map presence-absence (interactive mode)",
    "text": "Map presence-absence (interactive mode)\nAgain, as an interactive map.\n\nlibrary(mapview)\nmapview(bnd, alpha.regions=0, lwd=2) + \n  mapview(abla, zcol='PresenceAbsence', col.regions=c('red','blue'), cex=2)"
  },
  {
    "objectID": "tutorials/occurrence.html#introduction",
    "href": "tutorials/occurrence.html#introduction",
    "title": "Species distribution modelling",
    "section": "",
    "text": "This is a five part minimalist tutorial on modelling the current and future distribution of subalpine fir in the southeast Yukon and northcentral BC.\nFirst, we’re going to load a bunch of packages that will be used throughout the tutorial.\n\n\nYou will first need to make sure you have the R packages listed below, otherwise you will need to install them using the install.packages function:\n\n# Uncomment the next line to install the packages\n#install.packages(c('sf', 'tmap', 'dplyr', 'terra', 'tmaptools', 'geodata', 'mapview'))\n\n\n\n\n\n# Load required packages\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(geodata)\nlibrary(ggplot2)\nlibrary(mapview)\nlibrary(tmaptools)\nlibrary(tidyverse)\nsource('rasterdf.R')"
  },
  {
    "objectID": "tutorials/occurrence.html#methods",
    "href": "tutorials/occurrence.html#methods",
    "title": "Current and future subalpine fir distribution",
    "section": "Methods",
    "text": "Methods\n\nView study area\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\n\n\n\n\n\n\n\n\n\nDownload and prepare bioclimate data\nWe will use the worldclim_tile function in the geodata package to download a standard set of 19 bioclimatic variables from the Worlclim website. We will select the highest resolution data available (~1 km2) representing an average for the years 1970-2000 (climate normal). AdaptWest also provides a similar set of datasets, the disadvantage being that they have to be downloaded manually.\nThe KDTT study area requires that I download two tiles of data.\n\nbnd4326 &lt;- st_transform(bnd, 4326)\n# Uncomment next 2 lines to download climate data from Worlclim\nd1 &lt;- worldclim_tile(var='bio', lon=-128, lat=59, path='../data_raw/tmp')\nd2 &lt;- worldclim_tile(var='bio', lon=-128, lat=61, path='../data_raw/tmp')\n\n\n\nRead and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\nt1 &lt;- rast('../data_raw/tile_14_wc2.1_30s_bio.tif')\nnames(t1)\n\n [1] \"tile_14_wc2.1_30s_bio_1\"  \"tile_14_wc2.1_30s_bio_2\" \n [3] \"tile_14_wc2.1_30s_bio_3\"  \"tile_14_wc2.1_30s_bio_4\" \n [5] \"tile_14_wc2.1_30s_bio_5\"  \"tile_14_wc2.1_30s_bio_6\" \n [7] \"tile_14_wc2.1_30s_bio_7\"  \"tile_14_wc2.1_30s_bio_8\" \n [9] \"tile_14_wc2.1_30s_bio_9\"  \"tile_14_wc2.1_30s_bio_10\"\n[11] \"tile_14_wc2.1_30s_bio_11\" \"tile_14_wc2.1_30s_bio_12\"\n[13] \"tile_14_wc2.1_30s_bio_13\" \"tile_14_wc2.1_30s_bio_14\"\n[15] \"tile_14_wc2.1_30s_bio_15\" \"tile_14_wc2.1_30s_bio_16\"\n[17] \"tile_14_wc2.1_30s_bio_17\" \"tile_14_wc2.1_30s_bio_18\"\n[19] \"tile_14_wc2.1_30s_bio_19\"\n\nnames(t1) &lt;- paste0(\"bio\", c(1, 10:19, 2:9))\nnames(t1)\n\n [1] \"bio1\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[10] \"bio18\" \"bio19\" \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[19] \"bio9\" \n\nt2 &lt;- rast('../data_raw/tile_2_wc2.1_30s_bio.tif')\nnames(t2) &lt;- paste0(\"bio\", c(1, 10:19, 2:9))\nnames(t2)\n\n [1] \"bio1\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[10] \"bio18\" \"bio19\" \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[19] \"bio9\" \n\n\n\n\nClip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\nt1_crop &lt;- crop(t1, vect(bnd4326))\nt1_msk &lt;- mask(t1_crop, vect(bnd4326))\nt2_crop &lt;- crop(t2, vect(bnd4326))\nt2_msk &lt;- mask(t2_crop, vect(bnd4326))\ntt &lt;- merge(t1_msk, t2_msk)\ntt\n\nclass       : SpatRaster \ndimensions  : 848, 1384, 19  (nrow, ncol, nlyr)\nresolution  : 0.008333333, 0.008333333  (x, y)\nextent      : -135.175, -123.6417, 56.75, 63.81667  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsource(s)   : memory\nvarname     : tile_14_wc2.1_30s_bio \nnames       :      bio1,     bio10, bio11, bio12, bio13, bio14, ... \nmin values  : -11.83333,  1.283333, -24.8,   254,    51,     4, ... \nmax values  :   0.81250, 15.533333, -12.4,   829,   133,    36, ... \n\n#writeRaster(tt, 'data/bio.tif', overwrite=TRUE)\n\n\n\nView some of the merged raster layers\nWe will take a look at two of the layers, temperature and precipitation.\nTemperature\nbio5 = Max Temperature of Warmest Month\n\npal &lt;- get_brewer_pal(\"-RdYlBu\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio5\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=pal), \n    col.legend = tm_legend(title = \"Temperature (*C)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\n\n\n\n\n\n\n\n\nPrecipitation\nbio13 = Precipitation of Wettest Month\n\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\n\n\n\n\n\n\n\n\n\n\nExtract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nabla_pts &lt;- st_read('data/kdtt.gpkg', 'abla') %&gt;%\n  st_transform(4326)\n\nReading layer `abla' from data source \n  `C:\\Users\\PIVER37\\Documents\\github\\beaconsproject\\coding\\tutorials\\data\\kdtt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\n\nabla_bio &lt;- terra::extract(tt, vect(abla_pts))\nabla_pts_bio &lt;- bind_cols(abla_pts, abla_bio)\nabla_pts_bio\n\nSimple feature collection with 1965 features and 22 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -135.1869 ymin: 56.71846 xmax: -123.605 ymax: 63.79814\nGeodetic CRS:  WGS 84\nFirst 10 features:\n   Occurrence PresenceAbsence ID       bio1     bio10     bio11 bio12 bio13\n1           0          Absent  1 -1.9625000 13.833333 -19.31667   497    95\n2           0          Absent  2 -2.3541667 10.900000 -16.20000   529    87\n3           0          Absent  3 -2.2750001 12.950000 -19.73333   453    67\n4           0          Absent  4 -5.7375002  8.599999 -18.68333   368    69\n5           0          Absent  5 -0.4041666 12.183333 -14.05000   490    67\n6           0          Absent  6 -3.0874999 13.316667 -21.28333   481    78\n7           0          Absent  7 -4.3833332  7.150000 -15.13333   673    89\n8           0          Absent  8 -7.5625000  7.616667 -21.06667   601    95\n9           0          Absent  9 -3.8625000 11.683333 -20.98333   499    73\n10          0          Absent 10 -3.8333333 11.066667 -19.33333   291    56\n   bio14    bio15 bio16 bio17 bio18 bio19     bio2     bio3      bio4 bio5\n1     18 59.72225   236    58   236    65 11.37500 23.84696 1361.7103 21.4\n2     21 44.35683   219    70   219   100 11.67500 27.79762 1110.5802 18.4\n3     18 37.28563   173    64   173    92 12.03333 24.65847 1338.5551 20.9\n4     14 54.75156   168    47   168    55 11.47500 26.87354 1132.0378 16.3\n5     13 36.72025   174    60   174   123 11.35833 27.70325 1067.7471 19.6\n6     21 42.57211   198    69   198    86 12.25833 23.89539 1419.1597 21.7\n7     21 32.92192   236    98   236   151 10.55000 28.98352  917.8218 14.3\n8     29 43.76863   251    91   251    98 10.77500 24.54442 1199.4926 15.3\n9     20 39.83319   194    68   194    91 12.02500 24.74280 1337.6661 19.5\n10     9 57.27034   135    32   135    44 13.36667 28.25934 1251.1655 19.7\n    bio6 bio7      bio8       bio9                       geom\n1  -26.3 47.7 13.833333  -9.216666 POINT (-124.4427 60.07953)\n2  -23.6 42.0 10.900000  -8.283334 POINT (-126.4029 59.11991)\n3  -27.9 48.8 12.950000  -8.433333   POINT (-127.2625 59.829)\n4  -26.4 42.7  8.599999 -12.183333 POINT (-132.6516 62.73448)\n5  -21.4 41.0 12.183333  -5.616667  POINT (-126.226 57.62838)\n6  -29.6 51.3 13.316667  -9.750000  POINT (-126.0417 60.4285)\n7  -22.1 36.4  7.150000  -9.800000  POINT (-126.8268 57.8491)\n8  -28.6 43.9  7.616667 -14.716667 POINT (-127.1326 62.11206)\n9  -29.1 48.6 11.683333 -10.333334 POINT (-128.3891 60.67085)\n10 -27.6 47.3 11.066667 -10.183333 POINT (-132.2993 61.79676)\n\n\n\n\nMap bioclimate values at points\n\ntmap_mode(\"view\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla_pts_bio) + tm_dots(fill='bio3', size=0.3,\n    fill.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\nMap bioclimate raster with presence/absence\n\ntmap_mode(\"view\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(tt[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd4326) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla_pts_bio) + tm_dots(fill='PresenceAbsence', size=0.3,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\n\nSplit sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\n#set.seed(123)\nabla_train &lt;- abla_pts_bio %&gt;%\n  sample_frac(size = 0.7)\ntable(abla_train$PresenceAbsence)\n\n\n Absent Present \n    710     666 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ntable(abla_val$PresenceAbsence)\n\n&lt; table of extent 0 &gt;"
  },
  {
    "objectID": "tutorials/subfir4_model.html#diagnostic-plot",
    "href": "tutorials/subfir4_model.html#diagnostic-plot",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Diagnostic plot",
    "text": "Diagnostic plot\nPartial residual plots show the nonparametric relationships between subalpine fir occurrence and the predictor variables. They can be generated using the gbm.plot() function from the dismo package. Here, the partial plots for the four most important predictors are shown in a 2 x 2 layout.\nOver the range of temperatures in the study area, subalpine fir probability of occurrence:\n\nis highest at lowest temperature seasonality and declines monotonically when CV&gt;1100 (bio4)\nis highest when mean temperature of the warmest quarter is between 8-11 degrees (bio10)\nis highest when precipitation in the coldest quarter is greater than 100 cm (bio19)\nis highest when mean temperature during the driest quarter is between 16-18 degrees (bio9)\n\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))"
  },
  {
    "objectID": "tutorials/subfir4_model.html#predict-values-at-all-pixels",
    "href": "tutorials/subfir4_model.html#predict-values-at-all-pixels",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predict values at all pixels",
    "text": "Predict values at all pixels\nWe can now use our model to predict the probability of occurrence of subalpine fir at all locations in our study area using the predict function in the dismo package.\n\nabla_cur &lt;- predict(object = bio, # bioclimatic variables\n                    model = abla_mod, # model\n                    type = \"response\", \n                    na.rm = TRUE)\nwriteRaster(abla_cur, 'data/abla_current.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#predicted-probability-map-with-subalpine-fir",
    "href": "tutorials/subfir4_model.html#predicted-probability-map-with-subalpine-fir",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted probability map with subalpine fir",
    "text": "Predicted probability map with subalpine fir\nNow, let’s see the map with the subalpine fir presence-absence data.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\nWe can clearly see that most of the absences are located in areas with lower predicted probability of occurrences, while most the presences are in the greener areas."
  },
  {
    "objectID": "tutorials/subfir4_model.html#other-accuracy-measures",
    "href": "tutorials/subfir4_model.html#other-accuracy-measures",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Other accuracy measures",
    "text": "Other accuracy measures\nSeveral other accuracy measures can be used and are shown in the graph. We’ll ignore them for now.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/subfir4_model.html#other-accuracy-measures-optional",
    "href": "tutorials/subfir4_model.html#other-accuracy-measures-optional",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Other accuracy measures (optional)",
    "text": "Other accuracy measures (optional)\nSeveral other accuracy measures can be used, including overall accuracy, true positive rate, and true negative rate and are shown in the graph. These can be calculated using the performance function. We won’t go into these other than to mention that we can use the results to suggest a cutoff value that would be effective for classifying presence or absence based on the predictions. For example, based on these plots, we could use a cutoff value around 0.56.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/subfir4_model.html#predicted-occurrence",
    "href": "tutorials/subfir4_model.html#predicted-occurrence",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted occurrence",
    "text": "Predicted occurrence\nWe can now use the cutoff value to reclassify our predicted probability of occurrence map into a presence/absence map. To do this we will first create a classification matrix and then use the classify function from the terra package.\n\nm &lt;- c(0, 0.56, 0,\n       0.56, 1, 1)\nrclmat &lt;- matrix(m, ncol=3, byrow=TRUE)\nabla_cur_01 &lt;- classify(abla_cur, rclmat)\n\nAnd here is the predicted presence/absence map, which provides us with an idea of the current range of subalpine fir.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/subfir4_model.html#next-week-looking-into-the-future",
    "href": "tutorials/subfir4_model.html#next-week-looking-into-the-future",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Next week: looking into the future",
    "text": "Next week: looking into the future\nNext week, we will download projected bioclimatic data and use our model to project the future range of subalpine fir under climate change. We will then compare the areal extent of the current and projected distributions to determine if and how subalpine fir distribution is predicted to change."
  },
  {
    "objectID": "tutorials/tmp.html",
    "href": "tutorials/tmp.html",
    "title": "Subalpine fir distribution - Part 4",
    "section": "",
    "text": "Objectives:\n\nExtract bioclimatic data using random subalpine fir location\nModel relationship between subalpine fir and bioclimatic variables\nMap predicted probability of occurrence of subalpine fir\nEvaluate the accuracy of the model"
  },
  {
    "objectID": "tutorials/tmp.html#introduction",
    "href": "tutorials/tmp.html#introduction",
    "title": "Subalpine fir distribution - Part 4",
    "section": "",
    "text": "Objectives:\n\nExtract bioclimatic data using random subalpine fir location\nModel relationship between subalpine fir and bioclimatic variables\nMap predicted probability of occurrence of subalpine fir\nEvaluate the accuracy of the model"
  },
  {
    "objectID": "tutorials/tmp.html#methods",
    "href": "tutorials/tmp.html#methods",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Methods",
    "text": "Methods\nLoad required libraries\n\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(tmaptools)\nlibrary(tidyverse)\nsource('rasterdf.R')"
  },
  {
    "objectID": "tutorials/tmp.html#extract-bioclimate-data-using-points",
    "href": "tutorials/tmp.html#extract-bioclimate-data-using-points",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Extract bioclimate data using points",
    "text": "Extract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nbio &lt;- rast('data/bio.tif')\nabla &lt;- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %&gt;%\n  st_transform(4326)\nabla_bio &lt;- terra::extract(bio, abla) %&gt;%\n  bind_cols(abla) %&gt;%\n  mutate(PresenceAbsence=NULL) %&gt;%\n  rename(abla=Occurrence) %&gt;%\n  as.data.frame()\nnames(abla_bio)\n\n [1] \"ID\"    \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[10] \"bio9\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[19] \"bio18\" \"bio19\" \"abla\"  \"geom\" \n\nhead(abla_bio)\n\n  ID       bio1      bio2      bio3 bio4 bio5 bio6     bio7 bio8 bio9 bio10\n1  1 -1.9625000 13.833333 -19.31667  497   95   18 59.72225  236   58   236\n2  2 -2.3541667 10.900000 -16.20000  529   87   21 44.35683  219   70   219\n3  3 -2.2750001 12.950000 -19.73333  453   67   18 37.28563  173   64   173\n4  4 -5.7375002  8.599999 -18.68333  368   69   14 54.75156  168   47   168\n5  5 -0.4041666 12.183333 -14.05000  490   67   13 36.72025  174   60   174\n6  6 -3.0874999 13.316667 -21.28333  481   78   21 42.57211  198   69   198\n  bio11    bio12    bio13    bio14 bio15 bio16 bio17     bio18      bio19 abla\n1    65 11.37500 23.84696 1361.710  21.4 -26.3  47.7 13.833333  -9.216666    0\n2   100 11.67500 27.79762 1110.580  18.4 -23.6  42.0 10.900000  -8.283334    0\n3    92 12.03333 24.65847 1338.555  20.9 -27.9  48.8 12.950000  -8.433333    0\n4    55 11.47500 26.87354 1132.038  16.3 -26.4  42.7  8.599999 -12.183333    0\n5   123 11.35833 27.70325 1067.747  19.6 -21.4  41.0 12.183333  -5.616667    0\n6    86 12.25833 23.89539 1419.160  21.7 -29.6  51.3 13.316667  -9.750000    0\n                        geom\n1 POINT (-124.4427 60.07953)\n2 POINT (-126.4029 59.11991)\n3   POINT (-127.2625 59.829)\n4 POINT (-132.6516 62.73448)\n5  POINT (-126.226 57.62838)\n6  POINT (-126.0417 60.4285)\n\nabla_bio_3578 &lt;- st_transform(st_as_sf(abla_bio), 3578)\nst_write(abla_bio_3578, 'data/kdtt.gpkg', 'bio', delete_layer=T)\n\nDeleting layer `bio' using driver `GPKG'\nWriting layer `bio' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 21 fields and geometry type Point.\n\n\n\n#tm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bio[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/tmp.html#split-sample-into-training-and-testing",
    "href": "tutorials/tmp.html#split-sample-into-training-and-testing",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Split sample into training and testing",
    "text": "Split sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\nset.seed(123)\nabla_train &lt;- abla_bio %&gt;%\n  sample_frac(size = 0.7)\ncat(\"Training data (70%):\\n\")\n\nTraining data (70%):\n\ntable(abla_train$abla)\n\n\n  0   1 \n697 679 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ncat(\"\\n\\nTesting data (30%):\\n\")\n\n\n\nTesting data (30%):\n\ntable(abla_val$abla)\n\n\n  0   1 \n303 286"
  },
  {
    "objectID": "tutorials/tmp.html#boosted-regression-tree",
    "href": "tutorials/tmp.html#boosted-regression-tree",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Boosted regression tree",
    "text": "Boosted regression tree\nNow, we’re going to use our training data to develop a boosted regression tree model. You can easily find details about this type of model online and, eventually, in the resources pages of this coding website. The model will attempt to predict the probability of occurrence of subalpine fir as a function of one or more bioclimatic variable.\n\nabla_mod &lt;- gbm.step(data = abla_train, # data used to train model\n                     gbm.x = 2:20, # predictor variables\n                     gbm.y = 21, # response variable\n                     family = \"bernoulli\", # bernoulli is appropriate for occurrence data\n                     tree.complexity = 3,\n                     learning.rate = 0.01, \n                     bag.fraction = 0.5,\n                     plot.main = FALSE, \n                     verbose = FALSE, \n                     silent = TRUE)\nsaveRDS(abla_mod, 'data/abla_mod.rda')\nabla_imp &lt;- summary(abla_mod, plotit = FALSE)\ncat('Relative importance of bioclimatic variables:\\n')\n\nRelative importance of bioclimatic variables:\n\nabla_imp\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\nsummary(abla_mod)\n\n\n\n\n\n\n\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\n\nTop four variables:\n\nbio14 - Precipitation of Driest Month\nbio2 - Mean Diurnal Range (Mean of monthly max temp - min temp)\nbio11 - Mean Temperature of Coldest Quarter\nbio15 - Precipitation Seasonality (Coefficient of Variation)"
  },
  {
    "objectID": "tutorials/tmp.html#diagnostic-plot",
    "href": "tutorials/tmp.html#diagnostic-plot",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Diagnostic plot",
    "text": "Diagnostic plot\nPartial residual plots show the nonparametric relationships between subalpine fir occurrence and the predictor variables. They can be generated using the gbm.plot() function from the dismo package. Here, the partial plots for the four most important predictors are shown in a 2 x 2 layout.\nOver the range of temperatures in the study area, subalpine fir probability of occurrence:\n\nis highest at lowest temperature seasonality and declines monotonically when CV&gt;1100 (bio4)\nis highest when mean temperature of the warmest quarter is between 8-11 degrees (bio10)\nis highest when precipitation in the coldest quarter is greater than 100 cm (bio19)\nis highest when mean temperature during the driest quarter is between 16-18 degrees (bio9)\n\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))"
  },
  {
    "objectID": "tutorials/tmp.html#predict-values-at-all-pixels",
    "href": "tutorials/tmp.html#predict-values-at-all-pixels",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predict values at all pixels",
    "text": "Predict values at all pixels\nWe can now use our model to predict the probability of occurrence of subalpine fir at all locations in our study area using the predict function in the dismo package.\n\nabla_cur &lt;- predict(object = bio, # bioclimatic variables\n                    model = abla_mod, # model\n                    type = \"response\", \n                    na.rm = TRUE)\nwriteRaster(abla_cur, 'data/abla_current.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/tmp.html#predicted-probability-map",
    "href": "tutorials/tmp.html#predicted-probability-map",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted probability map",
    "text": "Predicted probability map\nWe can now map the predicted probability of occurrence of subalpine fir across our study area.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/tmp.html#predicted-probability-map-with-subalpine-fir",
    "href": "tutorials/tmp.html#predicted-probability-map-with-subalpine-fir",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted probability map with subalpine fir",
    "text": "Predicted probability map with subalpine fir\nNow, let’s see the map with the subalpine fir presence-absence data.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\nWe can clearly see that most of the absences are located in areas with lower predicted probability of occurrences, while most the presences are in the greener areas."
  },
  {
    "objectID": "tutorials/tmp.html#accuracy-assessment",
    "href": "tutorials/tmp.html#accuracy-assessment",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Accuracy Assessment",
    "text": "Accuracy Assessment\nAn important step in statistical modelling is to evaluate the accuracy of the models. Ideally, we would use spatially and temporally independent data. However, this is rarely possible or affordable. Instead, we can use our hold-out or testing dataset to evaluate the predictive accuracy of our model. The code below creates a data frame from the observed and predicted data that will be used to calculate and plot a measure of predicted accuracy known as the Area under the receiver operating characteristics (ROC) curve. We can ignore the code for now.\n\nabla_pred &lt;- predict(abla_mod, \n                     newdata = abla_val,\n                     type = \"response\")\nabla_predobs &lt;- prediction(abla_pred, abla_val$abla)\nabla_roc = performance(abla_predobs, \n                       measure = \"tpr\", \n                       x.measure = \"fpr\")\nabla_fpr &lt;- slot(abla_roc, \"x.values\")[[1]]\nabla_tpr &lt;- slot(abla_roc, \"y.values\")[[1]]\nabla_aucplot &lt;- data.frame(abla_fpr, abla_tpr)"
  },
  {
    "objectID": "tutorials/tmp.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "href": "tutorials/tmp.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Area under the receiver operating characteristics (ROC) curve",
    "text": "Area under the receiver operating characteristics (ROC) curve\nArea under the receiver operating characteristics (ROC) curve for predictions of subalpine fir occurrence based on WorldClim bioclimatic indices. We now use the table of observed and predicted observations to plot the ROC curve. If our model had no predictive capability, the curve would be a diagonal straight line. Curves that increasingly concave indicate higher accuracy.\n\nggplot(data = abla_aucplot) +\n  geom_line(aes(x = abla_fpr,\n                y = abla_tpr),\n            col = \"red\") +\n  labs(x = \"False Positive Rate\", \n       y = \"True Positive Rate\") +\n  geom_abline(slope = 1, intercept = 0) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/tmp.html#roc-value",
    "href": "tutorials/tmp.html#roc-value",
    "title": "Subalpine fir distribution - Part 4",
    "section": "ROC value",
    "text": "ROC value\nValues for the ROC curve range from 0 to 1, with values of 1 indicating perfect accuracy. Values of 0.5 indicate a random model, no better than the mean value of the occurrence data.\n\nabla_aucval &lt;- performance(abla_predobs, measure = \"auc\")\nslot(abla_aucval, \"y.values\")[[1]]\n\n[1] 0.9031249"
  },
  {
    "objectID": "tutorials/tmp.html#other-accuracy-measures-optional",
    "href": "tutorials/tmp.html#other-accuracy-measures-optional",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Other accuracy measures (optional)",
    "text": "Other accuracy measures (optional)\nSeveral other accuracy measures can be used, including overall accuracy, true positive rate, and true negative rate and are shown in the graph. These can be calculated using the performance function. We won’t go into these other than to mention that we can use the results to suggest a cutoff value that would be effective for classifying presence or absence based on the predictions. For example, based on these plots, we could use a cutoff value around 0.56.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/tmp.html#predicted-occurrence",
    "href": "tutorials/tmp.html#predicted-occurrence",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Predicted occurrence",
    "text": "Predicted occurrence\nWe can now use the cutoff value to reclassify our predicted probability of occurrence map into a presence/absence map. To do this we will first create a classification matrix and then use the classify function from the terra package.\n\nm &lt;- c(0, 0.56, 0,\n       0.56, 1, 1)\nrclmat &lt;- matrix(m, ncol=3, byrow=TRUE)\nabla_cur_01 &lt;- classify(abla_cur, rclmat)\n\nAnd here is the predicted presence/absence map, which provides us with an idea of the current range of subalpine fir.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/tmp.html#next-week-looking-into-the-future",
    "href": "tutorials/tmp.html#next-week-looking-into-the-future",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Next week: looking into the future",
    "text": "Next week: looking into the future\nNext week, we will download projected bioclimatic data and use our model to project the future range of subalpine fir under climate change. We will then compare the areal extent of the current and projected distributions to determine if and how subalpine fir distribution is predicted to change."
  },
  {
    "objectID": "tutorials/tmp.html#introduction-1",
    "href": "tutorials/tmp.html#introduction-1",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Introduction",
    "text": "Introduction\nObjectives:\n\nDownload projected bioclimatic data (tiles) from Worldclim\nClip the tiles to KDTT study area\nExtract projected bioclimatic data using random subalpine fir location\nApply bioclimatic data to model to project future distribution\n\n\nProjected bioclimatic data\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd') %&gt;%\n  st_transform(4326)\n\nReading layer `bnd' from data source \n  `C:\\Users\\PIVER37\\Documents\\github\\beaconsproject\\coding\\tutorials\\data\\kdtt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1 feature and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 360492.1 ymin: 263143.2 xmax: 1019017 ymax: 1039903\nProjected CRS: NAD83 / Yukon Albers\n\n# Uncomment next 2 lines to download climate data from Worlclim\n#url = \"https://geodata.ucdavis.edu/cmip6/30s/MPI-ESM1-2-HR/ssp245/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif\"\n#download.file(url, destfile=\"tmp/bio_proj.zip\")\n#unzip(\"bio_proj.zip\")\n\n\n\nRead and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\npbio &lt;- rast('../data_raw/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif')\nnames(pbio)\n\n [1] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_1\" \n [2] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_2\" \n [3] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_3\" \n [4] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_4\" \n [5] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_5\" \n [6] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_6\" \n [7] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_7\" \n [8] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_8\" \n [9] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_9\" \n[10] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_10\"\n[11] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_11\"\n[12] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_12\"\n[13] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_13\"\n[14] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_14\"\n[15] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_15\"\n[16] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_16\"\n[17] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_17\"\n[18] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_18\"\n[19] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_19\"\n\nnames(pbio) &lt;- paste0(\"bio\", 1:19)\nnames(pbio)\n\n [1] \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\"  \"bio9\" \n[10] \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\" \"bio18\"\n[19] \"bio19\"\n\n\n\n\nClip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\npbio_crop &lt;- crop(pbio, vect(bnd))\nbio_proj &lt;- mask(pbio_crop, vect(bnd))\nwriteRaster(bio_proj, 'data/bio_proj.tif', overwrite=TRUE)\n\n\nabla_cur &lt;- rast('data/abla_current.tif')\nabla_mod &lt;- readRDS('data/abla_mod.rda')\nabla_proj &lt;- predict(object = bio_proj, \n                     model = abla_mod, \n                     type = \"response\", \n                     na.rm = TRUE)\nwriteRaster(abla_proj, 'data/abla_future.tif', overwrite=TRUE)\nabla_chg &lt;- c(abla_cur, abla_proj)\nnames(abla_chg) &lt;- c(\"Current\", \"Future\")\nabla_clas &lt;- ifel(abla_chg &gt; 0.56, 1, 0)\n\n\npar(mfrow=c(1,2))\nplot(abla_cur)\nplot(abla_proj)\n\n\n\n\n\n\n\n\n\nplot(abla_clas$Current)\n\n\n\n\n\n\n\nplot(abla_clas$Future)\n\n\n\n\n\n\n\npar(mfrow=c(1,1))\n\n\nlibrary(ggplot2)\ncompare_bio &lt;- function(x, title) {\n  annmean &lt;- c(bio[[x]], bio_proj[[x]])\n  names(annmean) &lt;- c(\"Current\", \"Future\")\n  annmean_df &lt;- rasterdf(annmean) \n  ggplot(data = annmean_df) +\n    geom_histogram(aes(x = value), bins = 20) +\n    labs(x = title, \n         y = \"Count of observations\") +\n    facet_wrap(~ variable, ncol = 1) +\n    theme_bw()\n}\n\n## Precipitation of Driest Month\n\n\ncompare_bio(x=\"bio14\", title=\"Precipitation of Driest Month (mm)\")"
  },
  {
    "objectID": "tutorials/tmp.html#mean-diurnal-range",
    "href": "tutorials/tmp.html#mean-diurnal-range",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Mean Diurnal Range",
    "text": "Mean Diurnal Range\n\ncompare_bio(x=\"bio2\", title=\"Mean Diurnal Range (Mean of monthly max temp - min temp) (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/tmp.html#mean-temperature-of-coldest-quarter",
    "href": "tutorials/tmp.html#mean-temperature-of-coldest-quarter",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Mean Temperature of Coldest Quarter",
    "text": "Mean Temperature of Coldest Quarter\n\ncompare_bio(x=\"bio11\", title=\"Mean Temperature of Coldest Quarter (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/tmp.html#precipitation-seasonality",
    "href": "tutorials/tmp.html#precipitation-seasonality",
    "title": "Subalpine fir distribution - Part 4",
    "section": "Precipitation Seasonality",
    "text": "Precipitation Seasonality\n\ncompare_bio(x=\"bio15\", title=\"Precipitation Seasonality (Coefficient of Variation)\")"
  },
  {
    "objectID": "tutorials/occurrence2.html",
    "href": "tutorials/occurrence2.html",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "",
    "text": "# Load required packages\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(ggplot2)\nlibrary(tmaptools)\nlibrary(tidyverse)\nsource('rasterdf.R')"
  },
  {
    "objectID": "tutorials/occurrence2.html#extract-bioclimate-data-using-points",
    "href": "tutorials/occurrence2.html#extract-bioclimate-data-using-points",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Extract bioclimate data using points",
    "text": "Extract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nbio &lt;- rast('data/bio.tif')\nabla &lt;- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %&gt;%\n  st_transform(4326)\nabla_bio &lt;- terra::extract(bio, abla) %&gt;%\n  bind_cols(abla) %&gt;%\n  mutate(PresenceAbsence=NULL) %&gt;%\n  rename(abla=Occurrence) %&gt;%\n  as.data.frame()\nnames(abla_bio)\n\n [1] \"ID\"    \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[10] \"bio9\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[19] \"bio18\" \"bio19\" \"abla\"  \"geom\" \n\nhead(abla_bio)\n\n  ID       bio1      bio2      bio3 bio4 bio5 bio6     bio7 bio8 bio9 bio10\n1  1 -1.9625000 13.833333 -19.31667  497   95   18 59.72225  236   58   236\n2  2 -2.3541667 10.900000 -16.20000  529   87   21 44.35683  219   70   219\n3  3 -2.2750001 12.950000 -19.73333  453   67   18 37.28563  173   64   173\n4  4 -5.7375002  8.599999 -18.68333  368   69   14 54.75156  168   47   168\n5  5 -0.4041666 12.183333 -14.05000  490   67   13 36.72025  174   60   174\n6  6 -3.0874999 13.316667 -21.28333  481   78   21 42.57211  198   69   198\n  bio11    bio12    bio13    bio14 bio15 bio16 bio17     bio18      bio19 abla\n1    65 11.37500 23.84696 1361.710  21.4 -26.3  47.7 13.833333  -9.216666    0\n2   100 11.67500 27.79762 1110.580  18.4 -23.6  42.0 10.900000  -8.283334    0\n3    92 12.03333 24.65847 1338.555  20.9 -27.9  48.8 12.950000  -8.433333    0\n4    55 11.47500 26.87354 1132.038  16.3 -26.4  42.7  8.599999 -12.183333    0\n5   123 11.35833 27.70325 1067.747  19.6 -21.4  41.0 12.183333  -5.616667    0\n6    86 12.25833 23.89539 1419.160  21.7 -29.6  51.3 13.316667  -9.750000    0\n                        geom\n1 POINT (-124.4427 60.07953)\n2 POINT (-126.4029 59.11991)\n3   POINT (-127.2625 59.829)\n4 POINT (-132.6516 62.73448)\n5  POINT (-126.226 57.62838)\n6  POINT (-126.0417 60.4285)\n\nabla_bio_3578 &lt;- st_transform(st_as_sf(abla_bio), 3578)\nst_write(abla_bio_3578, 'data/kdtt.gpkg', 'bio', delete_layer=T)\n\nDeleting layer `bio' using driver `GPKG'\nWriting layer `bio' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 21 fields and geometry type Point.\n\n\n\n#tm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bio[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/occurrence2.html#split-sample-into-training-and-testing",
    "href": "tutorials/occurrence2.html#split-sample-into-training-and-testing",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Split sample into training and testing",
    "text": "Split sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\nset.seed(123)\nabla_train &lt;- abla_bio %&gt;%\n  sample_frac(size = 0.7)\ncat(\"Training data (70%):\\n\")\n\nTraining data (70%):\n\ntable(abla_train$abla)\n\n\n  0   1 \n697 679 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ncat(\"\\n\\nTesting data (30%):\\n\")\n\n\n\nTesting data (30%):\n\ntable(abla_val$abla)\n\n\n  0   1 \n303 286"
  },
  {
    "objectID": "tutorials/occurrence2.html#boosted-regression-tree",
    "href": "tutorials/occurrence2.html#boosted-regression-tree",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Boosted regression tree",
    "text": "Boosted regression tree\nNow, we’re going to use our training data to develop a boosted regression tree model. You can easily find details about this type of model online and, eventually, in the resources pages of this coding website. The model will attempt to predict the probability of occurrence of subalpine fir as a function of one or more bioclimatic variable.\n\nabla_mod &lt;- gbm.step(data = abla_train, # data used to train model\n                     gbm.x = 2:20, # predictor variables\n                     gbm.y = 21, # response variable\n                     family = \"bernoulli\", # bernoulli is appropriate for occurrence data\n                     tree.complexity = 3,\n                     learning.rate = 0.01, \n                     bag.fraction = 0.5,\n                     plot.main = FALSE, \n                     verbose = FALSE, \n                     silent = TRUE)\n#saveRDS(abla_mod, 'data/abla_mod.rda')\nabla_imp &lt;- summary(abla_mod, plotit = FALSE)\nsummary(abla_mod)\n\n\n\n\n\n\n\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\n\nTop four variables:\n\nbio14 - Precipitation of Driest Month\nbio2 - Mean Diurnal Range (Mean of monthly max temp - min temp)\nbio11 - Mean Temperature of Coldest Quarter\nbio15 - Precipitation Seasonality (Coefficient of Variation)"
  },
  {
    "objectID": "tutorials/occurrence2.html#diagnostic-plot",
    "href": "tutorials/occurrence2.html#diagnostic-plot",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Diagnostic plot",
    "text": "Diagnostic plot\nPartial residual plots show the nonparametric relationships between subalpine fir occurrence and the predictor variables. They can be generated using the gbm.plot() function from the dismo package. Here, the partial plots for the four most important predictors are shown in a 2 x 2 layout.\nOver the range of temperatures in the study area, subalpine fir probability of occurrence:\n\nis highest at lowest precipitation and declines monotonically when CV&gt;1100 (bio14)\nis highest when mean diurnal range is between 8-11 degrees (bio2)\nis highest when bio11 is greater than 100 cm (bio11)\nis highest when bio15 is between 16-18 degrees (bio15)\n\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))"
  },
  {
    "objectID": "tutorials/occurrence2.html#predict-values-at-all-pixels",
    "href": "tutorials/occurrence2.html#predict-values-at-all-pixels",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Predict values at all pixels",
    "text": "Predict values at all pixels\nWe can now use our model to predict the probability of occurrence of subalpine fir at all locations in our study area using the predict function in the dismo package.\n\nabla_cur &lt;- predict(object = bio, # bioclimatic variables\n                    model = abla_mod, # model\n                    type = \"response\", \n                    na.rm = TRUE)\nwriteRaster(abla_cur, 'data/abla_current.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/occurrence2.html#predicted-probability-map",
    "href": "tutorials/occurrence2.html#predicted-probability-map",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Predicted probability map",
    "text": "Predicted probability map\nWe can now map the predicted probability of occurrence of subalpine fir across our study area.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/occurrence2.html#predicted-probability-map-with-subalpine-fir",
    "href": "tutorials/occurrence2.html#predicted-probability-map-with-subalpine-fir",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Predicted probability map with subalpine fir",
    "text": "Predicted probability map with subalpine fir\nNow, let’s see the map with the subalpine fir presence-absence data.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\nWe can clearly see that most of the absences are located in areas with lower predicted probability of occurrences, while most the presences are in the greener areas."
  },
  {
    "objectID": "tutorials/occurrence2.html#accuracy-assessment",
    "href": "tutorials/occurrence2.html#accuracy-assessment",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Accuracy Assessment",
    "text": "Accuracy Assessment\nAn important step in statistical modelling is to evaluate the accuracy of the models. Ideally, we would use spatially and temporally independent data. However, this is rarely possible or affordable. Instead, we can use our hold-out or testing dataset to evaluate the predictive accuracy of our model. The code below creates a data frame from the observed and predicted data that will be used to calculate and plot a measure of predicted accuracy known as the Area under the receiver operating characteristics (ROC) curve. We can ignore the code for now.\n\nabla_pred &lt;- predict(abla_mod, \n                     newdata = abla_val,\n                     type = \"response\")\nabla_predobs &lt;- prediction(abla_pred, abla_val$abla)\nabla_roc = performance(abla_predobs, \n                       measure = \"tpr\", \n                       x.measure = \"fpr\")\nabla_fpr &lt;- slot(abla_roc, \"x.values\")[[1]]\nabla_tpr &lt;- slot(abla_roc, \"y.values\")[[1]]\nabla_aucplot &lt;- data.frame(abla_fpr, abla_tpr)"
  },
  {
    "objectID": "tutorials/occurrence2.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "href": "tutorials/occurrence2.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Area under the receiver operating characteristics (ROC) curve",
    "text": "Area under the receiver operating characteristics (ROC) curve\nArea under the receiver operating characteristics (ROC) curve for predictions of subalpine fir occurrence based on WorldClim bioclimatic indices. We now use the table of observed and predicted observations to plot the ROC curve. If our model had no predictive capability, the curve would be a diagonal straight line. Curves that increasingly concave indicate higher accuracy.\n\nggplot(data = abla_aucplot) +\n  geom_line(aes(x = abla_fpr,\n                y = abla_tpr),\n            col = \"red\") +\n  labs(x = \"False Positive Rate\", \n       y = \"True Positive Rate\") +\n  geom_abline(slope = 1, intercept = 0) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/occurrence2.html#roc-value",
    "href": "tutorials/occurrence2.html#roc-value",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "ROC value",
    "text": "ROC value\nValues for the ROC curve range from 0 to 1, with values of 1 indicating perfect accuracy. Values of 0.5 indicate a random model, no better than the mean value of the occurrence data.\n\nabla_aucval &lt;- performance(abla_predobs, measure = \"auc\")\nslot(abla_aucval, \"y.values\")[[1]]\n\n[1] 0.9031249"
  },
  {
    "objectID": "tutorials/occurrence2.html#other-accuracy-measures-optional",
    "href": "tutorials/occurrence2.html#other-accuracy-measures-optional",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Other accuracy measures (optional)",
    "text": "Other accuracy measures (optional)\nSeveral other accuracy measures can be used, including overall accuracy, true positive rate, and true negative rate and are shown in the graph. These can be calculated using the performance function. We won’t go into these other than to mention that we can use the results to suggest a cutoff value that would be effective for classifying presence or absence based on the predictions. For example, based on these plots, we could use a cutoff value around 0.56.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/occurrence2.html#predicted-occurrence",
    "href": "tutorials/occurrence2.html#predicted-occurrence",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Predicted occurrence",
    "text": "Predicted occurrence\nWe can now use the cutoff value to reclassify our predicted probability of occurrence map into a presence/absence map. To do this we will first create a classification matrix and then use the classify function from the terra package.\n\nm &lt;- c(0, 0.56, 0,\n       0.56, 1, 1)\nrclmat &lt;- matrix(m, ncol=3, byrow=TRUE)\nabla_cur_01 &lt;- classify(abla_cur, rclmat)\n\nAnd here is the predicted presence/absence map, which provides us with an idea of the current range of subalpine fir.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/occurrence2.html#projected-bioclimatic-data",
    "href": "tutorials/occurrence2.html#projected-bioclimatic-data",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Projected bioclimatic data",
    "text": "Projected bioclimatic data\nWe first download projected bioclimatic data for the period 2061-2080 from the Worldclim.org website.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd') %&gt;%\n  st_transform(4326)\n\nReading layer `bnd' from data source \n  `C:\\Users\\PIVER37\\Documents\\github\\beaconsproject\\coding\\tutorials\\data\\kdtt.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1 feature and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 360492.1 ymin: 263143.2 xmax: 1019017 ymax: 1039903\nProjected CRS: NAD83 / Yukon Albers\n\n# Uncomment next 2 lines to download climate data from Worlclim\n#url = \"https://geodata.ucdavis.edu/cmip6/30s/MPI-ESM1-2-HR/ssp245/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif\"\n#download.file(url, destfile=\"tmp/bio_proj.zip\")\n#unzip(\"bio_proj.zip\")"
  },
  {
    "objectID": "tutorials/occurrence2.html#read-and-rename-raster-layers",
    "href": "tutorials/occurrence2.html#read-and-rename-raster-layers",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Read and rename raster layers",
    "text": "Read and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\npbio &lt;- rast('../data_raw/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif')\nnames(pbio)\n\n [1] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_1\" \n [2] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_2\" \n [3] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_3\" \n [4] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_4\" \n [5] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_5\" \n [6] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_6\" \n [7] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_7\" \n [8] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_8\" \n [9] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_9\" \n[10] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_10\"\n[11] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_11\"\n[12] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_12\"\n[13] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_13\"\n[14] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_14\"\n[15] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_15\"\n[16] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_16\"\n[17] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_17\"\n[18] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_18\"\n[19] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_19\"\n\nnames(pbio) &lt;- paste0(\"bio\", 1:19)\nnames(pbio)\n\n [1] \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\"  \"bio9\" \n[10] \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\" \"bio18\"\n[19] \"bio19\""
  },
  {
    "objectID": "tutorials/occurrence2.html#clip-covariates-to-study-area",
    "href": "tutorials/occurrence2.html#clip-covariates-to-study-area",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Clip covariates to study area",
    "text": "Clip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\npbio_crop &lt;- crop(pbio, vect(bnd))\nbio_proj &lt;- mask(pbio_crop, vect(bnd))\nwriteRaster(bio_proj, 'data/bio_proj.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/occurrence2.html#apply-model-to-projected-bioclimatic-rasters",
    "href": "tutorials/occurrence2.html#apply-model-to-projected-bioclimatic-rasters",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Apply model to projected bioclimatic rasters",
    "text": "Apply model to projected bioclimatic rasters\n\nabla_cur &lt;- rast('data/abla_current.tif')\nabla_mod &lt;- readRDS('data/abla_mod.rda')\nabla_proj &lt;- predict(object = bio_proj, \n                     model = abla_mod, \n                     type = \"response\", \n                     na.rm = TRUE)\nwriteRaster(abla_proj, 'data/abla_future.tif', overwrite=TRUE)\nabla_chg &lt;- c(abla_cur, abla_proj)\nnames(abla_chg) &lt;- c(\"Current\", \"Future\")\nabla_clas &lt;- ifel(abla_chg &gt; 0.56, 1, 0)"
  },
  {
    "objectID": "tutorials/occurrence2.html#current-and-future-predicted-probability",
    "href": "tutorials/occurrence2.html#current-and-future-predicted-probability",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Current and future predicted probability",
    "text": "Current and future predicted probability\n\npar(mfrow=c(1,2))\nplot(abla_cur)\nplot(abla_proj)\n\n\n\n\n\n\n\npar(mfrow=c(1,1))"
  },
  {
    "objectID": "tutorials/occurrence2.html#current-and-future-predicted-range",
    "href": "tutorials/occurrence2.html#current-and-future-predicted-range",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Current and future predicted range",
    "text": "Current and future predicted range\n\npar(mfrow=c(1,2))\nplot(abla_clas$Current)\nplot(abla_clas$Future)\n\n\n\n\n\n\n\npar(mfrow=c(1,1))"
  },
  {
    "objectID": "tutorials/occurrence2.html#comparing-current-and-future-bioclimatic-variables",
    "href": "tutorials/occurrence2.html#comparing-current-and-future-bioclimatic-variables",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Comparing current and future bioclimatic variables",
    "text": "Comparing current and future bioclimatic variables\nWe’ll first create a simple function for plotting two histograms, one for the current bioclimatic variable and a second for the same variable projected into the future. We’ll then use the function to generate plots for the top four predictors in the model.\n\nlibrary(ggplot2)\ncompare_bio &lt;- function(x, title) {\n  annmean &lt;- c(bio[[x]], bio_proj[[x]])\n  names(annmean) &lt;- c(\"Current\", \"Future\")\n  annmean_df &lt;- rasterdf(annmean) \n  ggplot(data = annmean_df) +\n    geom_histogram(aes(x = value), bins = 20) +\n    labs(x = title, \n         y = \"Count of observations\") +\n    facet_wrap(~ variable, ncol = 1) +\n    theme_bw()\n}\n\n## Precipitation of Driest Month\n\n\ncompare_bio(x=\"bio14\", title=\"Precipitation of Driest Month (mm)\")"
  },
  {
    "objectID": "tutorials/occurrence2.html#mean-diurnal-range",
    "href": "tutorials/occurrence2.html#mean-diurnal-range",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Mean Diurnal Range",
    "text": "Mean Diurnal Range\n\ncompare_bio(x=\"bio2\", title=\"Mean Diurnal Range (Mean of monthly max temp - min temp) (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/occurrence2.html#mean-temperature-of-coldest-quarter",
    "href": "tutorials/occurrence2.html#mean-temperature-of-coldest-quarter",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Mean Temperature of Coldest Quarter",
    "text": "Mean Temperature of Coldest Quarter\n\ncompare_bio(x=\"bio11\", title=\"Mean Temperature of Coldest Quarter (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/occurrence2.html#precipitation-seasonality",
    "href": "tutorials/occurrence2.html#precipitation-seasonality",
    "title": "Subalpine fir distribution - Parts 4 & 5",
    "section": "Precipitation Seasonality",
    "text": "Precipitation Seasonality\n\ncompare_bio(x=\"bio15\", title=\"Precipitation Seasonality (Coefficient of Variation)\")"
  },
  {
    "objectID": "tutorials/occurrence.html#install-required-packages",
    "href": "tutorials/occurrence.html#install-required-packages",
    "title": "Current and future subalpine fir distribution",
    "section": "",
    "text": "You will first need to make sure you have the R packages listed below, otherwise you will need to install them using the install.packages function:\n\n# Uncomment the next line to install the packages\n#install.packages(c('sf', 'tmap', 'dplyr', 'terra', 'tmaptools', 'geodata', 'mapview'))"
  },
  {
    "objectID": "tutorials/occurrence.html#load-required-packages",
    "href": "tutorials/occurrence.html#load-required-packages",
    "title": "Current and future subalpine fir distribution",
    "section": "",
    "text": "# Load required packages\nlibrary(sf)\nlibrary(tmap)\nlibrary(ROCR)\nlibrary(dismo)\nlibrary(terra)\nlibrary(geodata)\nlibrary(ggplot2)\nlibrary(mapview)\nlibrary(tmaptools)\nlibrary(tidyverse)\nsource('rasterdf.R')"
  },
  {
    "objectID": "tutorials/occurrence.html#introduction-1",
    "href": "tutorials/occurrence.html#introduction-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Introduction",
    "text": "Introduction\nObjectives:\n\nDownload bioclimate data (tiles) from Worldclim\nClip the tiles to KDTT study area\nExtract bioclimate data using random subalpine fir location"
  },
  {
    "objectID": "tutorials/occurrence.html#clip-tree-raster-data-to-study-area-1",
    "href": "tutorials/occurrence.html#clip-tree-raster-data-to-study-area-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Clip tree raster data to study area",
    "text": "Clip tree raster data to study area\n\ntrees &lt;- rast('data/tree_species.tif') #|&gt;\n  #crop(bnd) |&gt;\n  #mask(bnd)\nplot(trees)\n\n\n\n\n\n\n\n\n\nTree species codes\n\n# https://gee-community-catalog.org/projects/ca_species/\nspp &lt;- tibble(code=c(0,3,10,16,17,18,23,29), # these are the species codes in the raster\n  spp=c('na','Subalpine fir','White birch','Engelmann spruce','White spruce',\n    'Black spruce','Lodgepole pine','Trembling aspen'))\nspp\n\n# A tibble: 8 × 2\n   code spp             \n  &lt;dbl&gt; &lt;chr&gt;           \n1     0 na              \n2     3 Subalpine fir   \n3    10 White birch     \n4    16 Engelmann spruce\n5    17 White spruce    \n6    18 Black spruce    \n7    23 Lodgepole pine  \n8    29 Trembling aspen"
  },
  {
    "objectID": "tutorials/occurrence.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0-1",
    "href": "tutorials/occurrence.html#reclassify-tree-species-map-to-subalpine-fir-1-and-everything-else-0-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Reclassify tree species map to subalpine fir = 1 and everything else = 0",
    "text": "Reclassify tree species map to subalpine fir = 1 and everything else = 0\n\nr_abla &lt;- classify(trees, rbind(c(-1,2,0),  c(2,3,1), c(4,30,0)))\n\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n\nplot(r_abla)"
  },
  {
    "objectID": "tutorials/occurrence.html#create-subalpine-fir-datasets-using-random-sample-of-pixels-1",
    "href": "tutorials/occurrence.html#create-subalpine-fir-datasets-using-random-sample-of-pixels-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Create subalpine fir datasets using random sample of pixels",
    "text": "Create subalpine fir datasets using random sample of pixels\nTo do this we’re going to randomly sample around 1000 subalpine fir pixels and 1000 non subalpine fir pixels. We first set a random number seed so that we can replicate the sample. Without setting a seed, you would get a different random sample each time you ran the code segment. This could be useful if you wanted to generate a few hundred or few thousand samples in order to get a distribution of random samples.\n\n# Set random number seed\nset.seed(123)\n\n# Draw a stratified random sample of 1000 pixels\nabla &lt;- spatSample(r_abla, 1000, method='stratified', xy=TRUE, values=TRUE, na.rm=TRUE) |&gt; \n  st_as_sf(coords = c(\"x\", \"y\"), crs=3578) # convert to an \"sf\" object\nabla\n\nSimple feature collection with 1965 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     b1              geometry\n7584  0 POINT (948045 648495)\n4033  0 POINT (849675 530145)\n3084  0 POINT (793995 604275)\n6577  0 POINT (492255 915765)\n6519  0 POINT (876135 366465)\n147   0 POINT (855525 676935)\n454   0 POINT (838035 387435)\n7135  0 POINT (779775 858195)\n2536  0 POINT (724785 693075)\n6343  0 POINT (510585 811215)\n\n\nThe new variable is called “b1” and contains values of 0 (absent) and 1 (present). We’ll rename it to “Occurrence” and create a second variable with character values “present” and “absent”.\n\n# Rename b1 and create a second variable which is a \nabla &lt;- rename(abla, Occurrence=b1) |&gt;\n  mutate(PresenceAbsence=ifelse(Occurrence==1, \"Present\", \"Absent\"), b1=NULL)\nabla\n\nSimple feature collection with 1965 features and 2 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 359535 ymin: 260505 xmax: 1017135 ymax: 1037325\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n     Occurrence              geometry PresenceAbsence\n7584          0 POINT (948045 648495)          Absent\n4033          0 POINT (849675 530145)          Absent\n3084          0 POINT (793995 604275)          Absent\n6577          0 POINT (492255 915765)          Absent\n6519          0 POINT (876135 366465)          Absent\n147           0 POINT (855525 676935)          Absent\n454           0 POINT (838035 387435)          Absent\n7135          0 POINT (779775 858195)          Absent\n2536          0 POINT (724785 693075)          Absent\n6343          0 POINT (510585 811215)          Absent\n\n# Uncomment to save results to a geopackage\nst_write(abla, 'data/kdtt.gpkg', 'abla', delete_layer=T)\n\nDeleting layer `abla' using driver `GPKG'\nWriting layer `abla' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 2 fields and geometry type Point."
  },
  {
    "objectID": "tutorials/occurrence.html#map-presence-absence-of-subalpine-fir-1",
    "href": "tutorials/occurrence.html#map-presence-absence-of-subalpine-fir-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Map presence-absence of subalpine fir",
    "text": "Map presence-absence of subalpine fir\n\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.3,\n  fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/occurrence.html#map-presence-absence-interactive-mode-1",
    "href": "tutorials/occurrence.html#map-presence-absence-interactive-mode-1",
    "title": "Current and future subalpine fir distribution",
    "section": "Map presence-absence (interactive mode)",
    "text": "Map presence-absence (interactive mode)\n\ntmap_mode(\"plot\")\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\n  tm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n    tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.3,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n    tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\n\nlibrary(mapview)\nmapview(bnd, alpha.regions=0, lwd=2) + \n  mapview(abla, zcol='PresenceAbsence', col.regions=c('red','blue'), cex=2)"
  },
  {
    "objectID": "tutorials/occurrence.html#extract-bioclimate-data-using-points-2",
    "href": "tutorials/occurrence.html#extract-bioclimate-data-using-points-2",
    "title": "Current and future subalpine fir distribution",
    "section": "Extract bioclimate data using points",
    "text": "Extract bioclimate data using points\nWe can now extract the bioclimate data using our random presence-absence points for subalpine fir. We first read the subalpine fir random presence/absence file that we created last time. We use that file to extract the 19 bioclimate variable values at each point. Finally, we merge them back to the points file.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nbio &lt;- rast('data/bio.tif')\nabla &lt;- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %&gt;%\n  st_transform(4326)\nabla_bio &lt;- terra::extract(bio, abla) %&gt;%\n  bind_cols(abla) %&gt;%\n  mutate(PresenceAbsence=NULL) %&gt;%\n  rename(abla=Occurrence) %&gt;%\n  as.data.frame()\nnames(abla_bio)\n\n [1] \"ID\"    \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\" \n[10] \"bio9\"  \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\"\n[19] \"bio18\" \"bio19\" \"abla\"  \"geom\" \n\nhead(abla_bio)\n\n  ID       bio1      bio2      bio3 bio4 bio5 bio6     bio7 bio8 bio9 bio10\n1  1 -1.9625000 13.833333 -19.31667  497   95   18 59.72225  236   58   236\n2  2 -2.3541667 10.900000 -16.20000  529   87   21 44.35683  219   70   219\n3  3 -2.2750001 12.950000 -19.73333  453   67   18 37.28563  173   64   173\n4  4 -5.7375002  8.599999 -18.68333  368   69   14 54.75156  168   47   168\n5  5 -0.4041666 12.183333 -14.05000  490   67   13 36.72025  174   60   174\n6  6 -3.0874999 13.316667 -21.28333  481   78   21 42.57211  198   69   198\n  bio11    bio12    bio13    bio14 bio15 bio16 bio17     bio18      bio19 abla\n1    65 11.37500 23.84696 1361.710  21.4 -26.3  47.7 13.833333  -9.216666    0\n2   100 11.67500 27.79762 1110.580  18.4 -23.6  42.0 10.900000  -8.283334    0\n3    92 12.03333 24.65847 1338.555  20.9 -27.9  48.8 12.950000  -8.433333    0\n4    55 11.47500 26.87354 1132.038  16.3 -26.4  42.7  8.599999 -12.183333    0\n5   123 11.35833 27.70325 1067.747  19.6 -21.4  41.0 12.183333  -5.616667    0\n6    86 12.25833 23.89539 1419.160  21.7 -29.6  51.3 13.316667  -9.750000    0\n                        geom\n1 POINT (-124.4427 60.07953)\n2 POINT (-126.4029 59.11991)\n3   POINT (-127.2625 59.829)\n4 POINT (-132.6516 62.73448)\n5  POINT (-126.226 57.62838)\n6  POINT (-126.0417 60.4285)\n\nabla_bio_3578 &lt;- st_transform(st_as_sf(abla_bio), 3578)\nst_write(abla_bio_3578, 'data/kdtt.gpkg', 'bio', delete_layer=T)\n\nDeleting layer `bio' using driver `GPKG'\nWriting layer `bio' to data source `data/kdtt.gpkg' using driver `GPKG'\nWriting 1965 features with 21 fields and geometry type Point.\n\n\n\n#tm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(bio[[\"bio13\"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"pretty\", values=\"Blues\"), \n    col.legend = tm_legend(title = \"Precipitation (mm)\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)"
  },
  {
    "objectID": "tutorials/occurrence.html#split-sample-into-training-and-testing-2",
    "href": "tutorials/occurrence.html#split-sample-into-training-and-testing-2",
    "title": "Current and future subalpine fir distribution",
    "section": "Split sample into training and testing",
    "text": "Split sample into training and testing\nPrior to developing a model, we split the data into a training (70%) and testing set (30%). Other splits or even multiple splits can be used. Next week we will use the training set to develop a simple model predicting subalpine fir occurrence. We will then use the holdout data or testing set to assess the predictive accuracy of the model.\n\nset.seed(123)\nabla_train &lt;- abla_bio %&gt;%\n  sample_frac(size = 0.7)\ncat(\"Training data (70%):\\n\")\n\nTraining data (70%):\n\ntable(abla_train$abla)\n\n\n  0   1 \n697 679 \n\nabla_val &lt;- abla_bio %&gt;%\n  anti_join(abla_train, by = \"ID\")\ncat(\"\\n\\nTesting data (30%):\\n\")\n\n\n\nTesting data (30%):\n\ntable(abla_val$abla)\n\n\n  0   1 \n303 286"
  },
  {
    "objectID": "tutorials/occurrence.html#boosted-regression-tree",
    "href": "tutorials/occurrence.html#boosted-regression-tree",
    "title": "Current and future subalpine fir distribution",
    "section": "Boosted regression tree",
    "text": "Boosted regression tree\nNow, we’re going to use our training data to develop a boosted regression tree model. You can easily find details about this type of model online and, eventually, in the resources pages of this coding website. The model will attempt to predict the probability of occurrence of subalpine fir as a function of one or more bioclimatic variable.\n\nabla_mod &lt;- gbm.step(data = abla_train, # data used to train model\n                     gbm.x = 2:20, # predictor variables\n                     gbm.y = 21, # response variable\n                     family = \"bernoulli\", # bernoulli is appropriate for occurrence data\n                     tree.complexity = 3,\n                     learning.rate = 0.01, \n                     bag.fraction = 0.5,\n                     plot.main = FALSE, \n                     verbose = FALSE, \n                     silent = TRUE)\n#saveRDS(abla_mod, 'data/abla_mod.rda')\nabla_imp &lt;- summary(abla_mod, plotit = FALSE)\nsummary(abla_mod)\n\n\n\n\n\n\n\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\n\nTop four variables:\n\nbio14 - Precipitation of Driest Month\nbio2 - Mean Diurnal Range (Mean of monthly max temp - min temp)\nbio11 - Mean Temperature of Coldest Quarter\nbio15 - Precipitation Seasonality (Coefficient of Variation)"
  },
  {
    "objectID": "tutorials/occurrence.html#diagnostic-plot",
    "href": "tutorials/occurrence.html#diagnostic-plot",
    "title": "Current and future subalpine fir distribution",
    "section": "Diagnostic plot",
    "text": "Diagnostic plot\nPartial residual plots show the nonparametric relationships between subalpine fir occurrence and the predictor variables. They can be generated using the gbm.plot() function from the dismo package. Here, the partial plots for the four most important predictors are shown in a 2 x 2 layout.\nOver the range of temperatures in the study area, subalpine fir probability of occurrence:\n\nis highest at lowest precipitation and declines monotonically when CV&gt;1100 (bio14)\nis highest when mean diurnal range is between 8-11 degrees (bio2)\nis highest when bio11 is greater than 100 cm (bio11)\nis highest when bio15 is between 16-18 degrees (bio15)\n\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))"
  },
  {
    "objectID": "tutorials/occurrence.html#predict-values-at-all-pixels",
    "href": "tutorials/occurrence.html#predict-values-at-all-pixels",
    "title": "Current and future subalpine fir distribution",
    "section": "Predict values at all pixels",
    "text": "Predict values at all pixels\nWe can now use our model to predict the probability of occurrence of subalpine fir at all locations in our study area using the predict function in the dismo package.\n\nabla_cur &lt;- predict(object = bio, # bioclimatic variables\n                    model = abla_mod, # model\n                    type = \"response\", \n                    na.rm = TRUE)\nwriteRaster(abla_cur, 'data/abla_current.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/occurrence.html#predicted-probability-map",
    "href": "tutorials/occurrence.html#predicted-probability-map",
    "title": "Current and future subalpine fir distribution",
    "section": "Predicted probability map",
    "text": "Predicted probability map\nWe can now map the predicted probability of occurrence of subalpine fir across our study area.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/occurrence.html#predicted-probability-map-with-subalpine-fir",
    "href": "tutorials/occurrence.html#predicted-probability-map-with-subalpine-fir",
    "title": "Current and future subalpine fir distribution",
    "section": "Predicted probability map with subalpine fir",
    "text": "Predicted probability map with subalpine fir\nNow, let’s see the map with the subalpine fir presence-absence data.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\nWe can clearly see that most of the absences are located in areas with lower predicted probability of occurrences, while most the presences are in the greener areas."
  },
  {
    "objectID": "tutorials/occurrence.html#accuracy-assessment",
    "href": "tutorials/occurrence.html#accuracy-assessment",
    "title": "Current and future subalpine fir distribution",
    "section": "Accuracy Assessment",
    "text": "Accuracy Assessment\nAn important step in statistical modelling is to evaluate the accuracy of the models. Ideally, we would use spatially and temporally independent data. However, this is rarely possible or affordable. Instead, we can use our hold-out or testing dataset to evaluate the predictive accuracy of our model. The code below creates a data frame from the observed and predicted data that will be used to calculate and plot a measure of predicted accuracy known as the Area under the receiver operating characteristics (ROC) curve. We can ignore the code for now.\n\nabla_pred &lt;- predict(abla_mod, \n                     newdata = abla_val,\n                     type = \"response\")\nabla_predobs &lt;- prediction(abla_pred, abla_val$abla)\nabla_roc = performance(abla_predobs, \n                       measure = \"tpr\", \n                       x.measure = \"fpr\")\nabla_fpr &lt;- slot(abla_roc, \"x.values\")[[1]]\nabla_tpr &lt;- slot(abla_roc, \"y.values\")[[1]]\nabla_aucplot &lt;- data.frame(abla_fpr, abla_tpr)"
  },
  {
    "objectID": "tutorials/occurrence.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "href": "tutorials/occurrence.html#area-under-the-receiver-operating-characteristics-roc-curve",
    "title": "Current and future subalpine fir distribution",
    "section": "Area under the receiver operating characteristics (ROC) curve",
    "text": "Area under the receiver operating characteristics (ROC) curve\nArea under the receiver operating characteristics (ROC) curve for predictions of subalpine fir occurrence based on WorldClim bioclimatic indices. We now use the table of observed and predicted observations to plot the ROC curve. If our model had no predictive capability, the curve would be a diagonal straight line. Curves that increasingly concave indicate higher accuracy.\n\nggplot(data = abla_aucplot) +\n  geom_line(aes(x = abla_fpr,\n                y = abla_tpr),\n            col = \"red\") +\n  labs(x = \"False Positive Rate\", \n       y = \"True Positive Rate\") +\n  geom_abline(slope = 1, intercept = 0) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/occurrence.html#roc-value",
    "href": "tutorials/occurrence.html#roc-value",
    "title": "Current and future subalpine fir distribution",
    "section": "ROC value",
    "text": "ROC value\nValues for the ROC curve range from 0 to 1, with values of 1 indicating perfect accuracy. Values of 0.5 indicate a random model, no better than the mean value of the occurrence data.\n\nabla_aucval &lt;- performance(abla_predobs, measure = \"auc\")\nslot(abla_aucval, \"y.values\")[[1]]\n\n[1] 0.9031249"
  },
  {
    "objectID": "tutorials/occurrence.html#other-accuracy-measures-optional",
    "href": "tutorials/occurrence.html#other-accuracy-measures-optional",
    "title": "Current and future subalpine fir distribution",
    "section": "Other accuracy measures (optional)",
    "text": "Other accuracy measures (optional)\nSeveral other accuracy measures can be used, including overall accuracy, true positive rate, and true negative rate and are shown in the graph. These can be calculated using the performance function. We won’t go into these other than to mention that we can use the results to suggest a cutoff value that would be effective for classifying presence or absence based on the predictions. For example, based on these plots, we could use a cutoff value around 0.56.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) %&gt;%\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/occurrence.html#predicted-occurrence",
    "href": "tutorials/occurrence.html#predicted-occurrence",
    "title": "Species distribution modelling",
    "section": "Predicted occurrence",
    "text": "Predicted occurrence\nWe can now use the cutoff value to reclassify our predicted probability of occurrence map into a presence/absence map. To do this we will first create a classification matrix and then use the classify function from the terra package.\n\nm &lt;- c(0, 0.56, 0,\n       0.56, 1, 1)\nrclmat &lt;- matrix(m, ncol=3, byrow=TRUE)\nabla_cur_01 &lt;- classify(abla_cur, rclmat)\n\nAnd here is the predicted presence/absence map, which provides us with an idea of the current range of subalpine fir.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)"
  },
  {
    "objectID": "tutorials/occurrence.html#projected-bioclimatic-data",
    "href": "tutorials/occurrence.html#projected-bioclimatic-data",
    "title": "Species distribution modelling",
    "section": "Projected bioclimatic data",
    "text": "Projected bioclimatic data\nThe WorldClim website also includes projected future climate grids based on GCMs from CMIP6. In this example, we use a projection for 2061-2080 (MPI-ESM1.2) based on RCP4.5, which assumes that CO2 emissions will start to decline before 2045 and reach about half of their 2050 levels by 2100. We first download projected bioclimatic data for the period 2061-2080 from the WorldClim.org website. These are the same variables that we used previously. The code to download the data has been commented out since it only needs to be done once. You can also change which scenarios to download. Note that, unlike the normal data we previously downloaded by tiles, this data can only be downloaded on a global scale.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE) |&gt;\n  st_transform(4326)\n# Uncomment next 2 lines to download climate data from Worlclim\n#url = \"https://geodata.ucdavis.edu/cmip6/30s/MPI-ESM1-2-HR/ssp245/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif\"\n#download.file(url, destfile=\"tmp/bio_proj.zip\")\n#unzip(\"bio_proj.zip\")\n\n\nRead and rename raster layers\nOnce downloaded, we rename the 19 bioclimatic rasters to bio1-bio19.\n\npbio &lt;- rast('../data_raw/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif')\nnames(pbio)\n\n [1] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_1\" \n [2] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_2\" \n [3] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_3\" \n [4] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_4\" \n [5] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_5\" \n [6] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_6\" \n [7] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_7\" \n [8] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_8\" \n [9] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_9\" \n[10] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_10\"\n[11] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_11\"\n[12] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_12\"\n[13] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_13\"\n[14] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_14\"\n[15] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_15\"\n[16] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_16\"\n[17] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_17\"\n[18] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_18\"\n[19] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_19\"\n\nnames(pbio) &lt;- paste0(\"bio\", 1:19)\nnames(pbio)\n\n [1] \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\"  \"bio9\" \n[10] \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\" \"bio18\"\n[19] \"bio19\"\n\n\n\n\nClip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimatic rasters.\n\npbio_crop &lt;- crop(pbio, vect(bnd))\nbio_proj &lt;- mask(pbio_crop, vect(bnd))\nwriteRaster(bio_proj, 'data/bio_proj.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/occurrence.html#read-and-rename-raster-layers-2",
    "href": "tutorials/occurrence.html#read-and-rename-raster-layers-2",
    "title": "Current and future subalpine fir distribution",
    "section": "Read and rename raster layers",
    "text": "Read and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\npbio &lt;- rast('../data_raw/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif')\nnames(pbio)\n\n [1] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_1\" \n [2] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_2\" \n [3] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_3\" \n [4] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_4\" \n [5] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_5\" \n [6] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_6\" \n [7] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_7\" \n [8] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_8\" \n [9] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_9\" \n[10] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_10\"\n[11] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_11\"\n[12] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_12\"\n[13] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_13\"\n[14] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_14\"\n[15] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_15\"\n[16] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_16\"\n[17] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_17\"\n[18] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_18\"\n[19] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_19\"\n\nnames(pbio) &lt;- paste0(\"bio\", 1:19)\nnames(pbio)\n\n [1] \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\"  \"bio9\" \n[10] \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\" \"bio18\"\n[19] \"bio19\""
  },
  {
    "objectID": "tutorials/occurrence.html#clip-covariates-to-study-area-2",
    "href": "tutorials/occurrence.html#clip-covariates-to-study-area-2",
    "title": "Current and future subalpine fir distribution",
    "section": "Clip covariates to study area",
    "text": "Clip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\npbio_crop &lt;- crop(pbio, vect(bnd))\nbio_proj &lt;- mask(pbio_crop, vect(bnd))\nwriteRaster(bio_proj, 'data/bio_proj.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tutorials/occurrence.html#apply-model-to-projected-bioclimatic-rasters",
    "href": "tutorials/occurrence.html#apply-model-to-projected-bioclimatic-rasters",
    "title": "Species distribution modelling",
    "section": "Apply model to projected bioclimatic rasters",
    "text": "Apply model to projected bioclimatic rasters\nNow we can use the same predict function as we used in Part 4 with the difference that we are using the projected bioclimatic data rather than the 30-year normal.\n\nabla_cur &lt;- rast('data/abla_current.tif')\nabla_mod &lt;- readRDS('data/abla_mod.rda')\nabla_proj &lt;- predict(object = bio_proj, \n                     model = abla_mod, \n                     type = \"response\", \n                     na.rm = TRUE)\nwriteRaster(abla_proj, 'data/abla_future.tif', overwrite=TRUE)\n\n\nCurrent and future predicted probability\nWe can now map the current and future predicted probability of occurence maps side-by-side using the par for parameter function and the mfrow argument - which specifies the number of rows and columns.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm1 &lt;- tm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\ntm2 &lt;- tm_shape(abla_proj) + tm_raster(col.scale=tm_scale_intervals(n=5, values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\ntmap_arrange(tm1, tm2)\n\n\n\n\n\n\n\n\n\n\nCurrent and future predicted range\nWe will again use our 0.56 probability cutoff to identify the presence of subalpine fir on the landscape. As an alternative to the classify functions we used in Part 4, here we use the ifel function to reclassify the probability map into a binary map showing the current or future distribution of subalpine fir. The maps are once again shown side-by-side. As we can see, the future distribution of subalpine fir is projected to be greatly reduce under this climate change scenario.\n\nabla_chg &lt;- c(abla_cur, abla_proj)\nnames(abla_chg) &lt;- c(\"Current\", \"Future\")\nabla_clas &lt;- ifel(abla_chg &gt; 0.56, 1, 0)\npar(mfrow = c(1, 2))\nplot(abla_clas$Current, axes=FALSE, mar = c(2, 2, 1, 1), legend=TRUE, box=TRUE)\nplot(st_geometry(bnd), add=TRUE)\nplot(abla_clas$Future, axes=FALSE, mar = c(2, 2, 1, 1), legend=FALSE, box=TRUE)\nplot(st_geometry(bnd), add=TRUE)\n\n\n\n\n\n\n\npar(mfrow = c(1, 1))"
  },
  {
    "objectID": "tutorials/occurrence.html#current-and-future-predicted-probability",
    "href": "tutorials/occurrence.html#current-and-future-predicted-probability",
    "title": "Species distribution modelling",
    "section": "Current and future predicted probability",
    "text": "Current and future predicted probability\n\npar(mfrow=c(1,2))\nplot(abla_cur)\nplot(abla_proj)\n\n\n\n\n\n\n\npar(mfrow=c(1,1))"
  },
  {
    "objectID": "tutorials/occurrence.html#current-and-future-predicted-range",
    "href": "tutorials/occurrence.html#current-and-future-predicted-range",
    "title": "Species distribution modelling",
    "section": "Current and future predicted range",
    "text": "Current and future predicted range\n\npar(mfrow=c(1,2))\nplot(abla_clas$Current)\nplot(abla_clas$Future)\n\n\n\n\n\n\n\npar(mfrow=c(1,1))"
  },
  {
    "objectID": "tutorials/occurrence.html#comparing-current-and-future-bioclimatic-variables",
    "href": "tutorials/occurrence.html#comparing-current-and-future-bioclimatic-variables",
    "title": "Species distribution modelling",
    "section": "Comparing current and future bioclimatic variables",
    "text": "Comparing current and future bioclimatic variables\nIn this last section, we’ll compare the current and future distribution of the top four predictor variables. We’ll first create a simple function for plotting two histograms, one for the current bioclimatic variable and a second for the same variable projected into the future. We’ll then use the function to generate plots for the top four predictors in the model.\n\nlibrary(ggplot2)\ncompare_bio &lt;- function(x, title) {\n  annmean &lt;- c(bio[[x]], bio_proj[[x]])\n  names(annmean) &lt;- c(\"Current\", \"Future\")\n  annmean_df &lt;- rasterdf(annmean) \n  ggplot(data = annmean_df) +\n    geom_histogram(aes(x = value), bins = 20) +\n    labs(x = title, \n         y = \"Count of observations\") +\n    facet_wrap(~ variable, ncol = 1) +\n    theme_bw()\n}\n\n\nPrecipitation of driest month\n\ncompare_bio(x=\"bio14\", title=\"Precipitation of Driest Month (mm)\")\n\n\n\n\n\n\n\n\n\n\nMean diurnal range\n\ncompare_bio(x=\"bio2\", title=\"Mean Diurnal Range (Mean of monthly max temp - min temp) (\\u00B0C)\")\n\n\n\n\n\n\n\n\n\n\nMean temperature of coldest quarter\n\ncompare_bio(x=\"bio11\", title=\"Mean Temperature of Coldest Quarter (\\u00B0C)\")\n\n\n\n\n\n\n\n\n\n\nPrecipitation seasonality\n\ncompare_bio(x=\"bio15\", title=\"Precipitation Seasonality (Coefficient of Variation)\")"
  },
  {
    "objectID": "tutorials/occurrence.html#mean-diurnal-range",
    "href": "tutorials/occurrence.html#mean-diurnal-range",
    "title": "Species distribution modelling",
    "section": "Mean Diurnal Range",
    "text": "Mean Diurnal Range\n\ncompare_bio(x=\"bio2\", title=\"Mean Diurnal Range (Mean of monthly max temp - min temp) (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/occurrence.html#mean-temperature-of-coldest-quarter",
    "href": "tutorials/occurrence.html#mean-temperature-of-coldest-quarter",
    "title": "Species distribution modelling",
    "section": "Mean Temperature of Coldest Quarter",
    "text": "Mean Temperature of Coldest Quarter\n\ncompare_bio(x=\"bio11\", title=\"Mean Temperature of Coldest Quarter (\\u00B0C)\")"
  },
  {
    "objectID": "tutorials/occurrence.html#precipitation-seasonality",
    "href": "tutorials/occurrence.html#precipitation-seasonality",
    "title": "Species distribution modelling",
    "section": "Precipitation Seasonality",
    "text": "Precipitation Seasonality\n\ncompare_bio(x=\"bio15\", title=\"Precipitation Seasonality (Coefficient of Variation)\")"
  },
  {
    "objectID": "tutorials/occurrence.html#part-1---subalpine-fir-data",
    "href": "tutorials/occurrence.html#part-1---subalpine-fir-data",
    "title": "Species distribution modelling",
    "section": "Part 1 - Subalpine fir data",
    "text": "Part 1 - Subalpine fir data\nIn part 1 of the tutorial, we will download (subalpine fir) species occurrence data from GBIF and plot it on our study area.\nObjectives:\n\nTo read and view a map of your study area\nTo download species data from GBIF\nTo map the distribution of species in your study area\n\n\nStudy area\nOur example study area is the Kaska Dene Traditional Territory that spans southeast Yukon and northcentral BC. We use the st_read function from the sf package to read the boundary layer from a geopackage file called kdtt.gpkg. We then use the generic plot function to view our study area boundary.\n\nbnd &lt;- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)\nplot(bnd)\n\n\n\n\n\n\n\n\n\n\nPlot geometry only\nThe plot function plots all attributes including the polygon geometry. To view only the outline of the study area we have to wrap the bnd object inside the st_geometry function.\n\nplot(st_geometry(bnd))\n\n\n\n\n\n\n\n\n\n\nPlot using the tmap package\nA more flexible approach is to use the **tmap* package.\n\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\n\n\n\n\n\n\n\n\n\nAdd a basemap\nWe can add a basemap to provide more context.\n\ntm_basemap(server = \"Esri.WorldTopoMap\") +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2)\n\nTiles from Esri.WorldTopoMap will be projected so details (e.g. text) could appear blurry\n\n\nSpatRaster object downsampled to 1087 by 921 cells.\n\n\n\n\n\n\n\n\n\n\n\nView interactive map\nAnother useful package is the mapview package. It is very useful for viewing an interactive plot of your data i.e., where you can zoom in and out and turn layers on and off.\n\nmapview(bnd)\n\n\n\n\n\n\n\nDistribution data\nSince we don’t have any of our own data, we will try to acquire existing subalpine fir location data. Sources of species distribution data include the Global Biodiversity Information Facility (GBIF). The geodata includes a function to download data from GBIF. The comments in the code below describe the steps to download the data.\n\n# Specify genus and species for species of interest (e.g., alces alces for moose)\ngenus = 'abies'\nspecies = 'lasiocarpa'\n\n# Buffer by 100k (optional but may result in additional nearby data)\nbnd100 &lt;- st_buffer(bnd, 100000)\n\n# Download GBIF data and convert to sf point object\ng &lt;- sp_occurrence(genus, species, geo=TRUE, end=2500)\n\n2500 records found\n\n\n0-300-600-900-1200-1500-1800-2100-2400-2500\n2500 records downloaded\n\n# Select a subset of attributes and convert to an sf object\ngg &lt;- select(g, lon, lat, year) |&gt;\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs=4326) |&gt;\n  st_transform(3578)\ngg\n\nSimple feature collection with 2500 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 163800.3 ymin: -1911086 xmax: 4047836 ymax: 7039517\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n   year                  geometry\n1  2024  POINT (2851010 -1046781)\n2  2024  POINT (2328168 -1201267)\n3  2024  POINT (163800.3 1082496)\n4  2024 POINT (1473910 -65676.52)\n5  2024 POINT (1374561 -513152.5)\n6  2024 POINT (1475957 -66714.07)\n7  2024  POINT (1475531 -66591.9)\n8  2024  POINT (2834823 -1122412)\n9  2024  POINT (2983006 -1541952)\n10 2024  POINT (2319437 -1519870)\n\n\n\n\nMap downloaded points\nNow we can view our downloaded data.\n\nmapview(bnd100, alpha.regions=0, lwd=1) + \n  mapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(gg, cex=1, col='red', col.regions='red', legend=NULL)\n\n\n\n\n\n\n\nSelect subset of data\nThe data we acquired from GBIF goes way beyond our study area. We will select only locations that fall within 100 km of our study area.\n\n# Select points that are within the buffered study region\ngg_sub &lt;- gg[bnd100,]\ngg_sub\n\nSimple feature collection with 38 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 332577.2 ymin: 321959.5 xmax: 1086028 ymax: 851177.9\nProjected CRS: NAD83 / Yukon Albers\nFirst 10 features:\n    year                  geometry\n294 2023 POINT (813462.6 321959.5)\n558 2023 POINT (612514.9 528531.3)\n559 2023 POINT (613483.9 529252.6)\n561 2023   POINT (614220.3 527707)\n563 2023   POINT (612667.4 528039)\n567 2023 POINT (612892.2 527972.3)\n568 2023 POINT (613465.1 529436.4)\n569 2023 POINT (636082.8 332375.1)\n572 2023 POINT (612564.2 528012.9)\n573 2023 POINT (613149.3 526483.9)\n\n\n\n\nPlot subalpine fir locations\nNow we use the tmap package to plot the distribution of subalpine fir locations along with the study area boundary.\n\n# Plot AOI + points\ntm_basemap(server = c(\"Esri.WorldTopoMap\", \"Esri.WorldImagery\")) +\ntm_shape(bnd) + tm_polygons(color='black', fill_alpha=0, lwd=2) +\n  tm_shape(bnd100) + tm_polygons(color='black', fill_alpha=0, lwd=1) +\n    tm_shape(gg_sub) + tm_dots()\n\nTiles from Esri.WorldTopoMap will be projected so details (e.g. text) could appear blurry\n\n\nSpatRaster object downsampled to 1087 by 921 cells.\n\n\n\n\n\n\n\n\n\n\n\nPlot subalpine fir locations (interactive)\nWe can do the same using the mapview package.\n\nlibrary(mapview)\nmapview(bnd100, alpha.regions=0, lwd=1) + \n  mapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(gg_sub, cex=4, col='red', col.regions='red', legend=NULL)"
  },
  {
    "objectID": "tutorials/occurrence.html#subalpine-fir-distribution---part-2",
    "href": "tutorials/occurrence.html#subalpine-fir-distribution---part-2",
    "title": "Species distribution modelling",
    "section": "Subalpine fir distribution - Part 2",
    "text": "Subalpine fir distribution - Part 2\nIn part 2 of the tutorial, we will sample presence and absence locations from a 30-m tree species raster for Canada (ref).\nObjectives:\n\nTo create a tree species raster map\nTo extract random presence/absence location from the raster\nTo create a map of the raster and location data"
  },
  {
    "objectID": "tutorials/occurrence.html#part-3---preparing-covariates",
    "href": "tutorials/occurrence.html#part-3---preparing-covariates",
    "title": "Species distribution modelling",
    "section": "Part 3 - Preparing covariates",
    "text": "Part 3 - Preparing covariates\nIn part 3 of the tutorial, we will download bioclimatic data for Worldclim, prepare them for analysis, and take a look at a few maps. This data will be used, in part 4, as covariates to develop species distribution model for subalpine fir.\nObjectives:\n\nDownload bioclimate data (tiles) from Worldclim\nClip the tiles to KDTT study area\nExtract bioclimate data using random subalpine fir location"
  },
  {
    "objectID": "tutorials/occurrence.html#develop-model",
    "href": "tutorials/occurrence.html#develop-model",
    "title": "Species distribution modelling",
    "section": "Develop model",
    "text": "Develop model\nNow, we’re going to use our training data to develop a boosted regression tree model. You can easily find details about this type of model online and, eventually, in the resources pages of this coding website. The model will attempt to predict the probability of occurrence of subalpine fir as a function of one or more bioclimatic variable.\n\nabla_mod &lt;- gbm.step(data = abla_train, # data used to train model\n                     gbm.x = 2:20, # predictor variables\n                     gbm.y = 21, # response variable\n                     family = \"bernoulli\", # bernoulli is appropriate for occurrence data\n                     tree.complexity = 3,\n                     learning.rate = 0.01, \n                     bag.fraction = 0.5,\n                     plot.main = FALSE, \n                     verbose = FALSE, \n                     silent = TRUE)\n#saveRDS(abla_mod, 'data/abla_mod.rda')\nabla_imp &lt;- summary(abla_mod, plotit = FALSE)\nsummary(abla_mod)\n\n\n\n\n\n\n\n\n        var    rel.inf\nbio14 bio14 23.2552338\nbio2   bio2 14.3337320\nbio11 bio11  9.6204212\nbio15 bio15  8.5497714\nbio17 bio17  8.0851729\nbio18 bio18  6.0617364\nbio13 bio13  5.6685015\nbio1   bio1  4.3731843\nbio3   bio3  3.3802936\nbio19 bio19  3.0075784\nbio9   bio9  2.5793392\nbio7   bio7  2.2871328\nbio12 bio12  2.0880090\nbio16 bio16  1.9255562\nbio6   bio6  1.4066853\nbio10 bio10  1.0118866\nbio4   bio4  0.9774735\nbio8   bio8  0.7073482\nbio5   bio5  0.6809438\n\n\nTop four variables:\n\nbio14 - Precipitation of Driest Month\nbio2 - Mean Diurnal Range (Mean of monthly max temp - min temp)\nbio11 - Mean Temperature of Coldest Quarter\nbio15 - Precipitation Seasonality (Coefficient of Variation)\n\n\nDiagnostic plot\nPartial residual plots show the nonparametric relationships between subalpine fir occurrence and the predictor variables. They can be generated using the gbm.plot() function from the dismo package. Here, the partial plots for the four most important predictors are shown in a 2 x 2 layout.\nOver the range of temperatures in the study area, subalpine fir probability of occurrence:\n\nis highest at lowest precipitation and declines monotonically when CV&gt;1100 (bio14)\nis highest when mean diurnal range is between 8-11 degrees (bio2)\nis highest when bio11 is greater than 100 cm (bio11)\nis highest when bio15 is between 16-18 degrees (bio15)\n\n\ngbm.plot(abla_mod, \n         n.plots = 4, \n         write.title = FALSE,\n         plot.layout = c(2, 2))\n\n\n\n\n\n\n\n\n\n\nPredict values at all pixels\nWe can now use our model to predict the probability of occurrence of subalpine fir at all locations in our study area using the predict function in the dismo package.\n\nabla_cur &lt;- predict(object = bio, # bioclimatic variables\n                    model = abla_mod, # model\n                    type = \"response\", \n                    na.rm = TRUE)\nwriteRaster(abla_cur, 'data/abla_current.tif', overwrite=TRUE)\n\n\n\nPredicted probability map\nWe can now map the predicted probability of occurrence of subalpine fir across our study area.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2)\n\n\n\n\n\n\n\n\n\n\nPredicted probability map with subalpine fir\nNow, let’s see the map with the subalpine fir presence-absence data.\n\npal &lt;- get_brewer_pal(\"YlGn\", n=5, plot=FALSE)\ntm_basemap(server = c(\"Esri.WorldTopoMap\")) +\ntm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style=\"quantile\", values=pal), \n    col.legend = tm_legend(title = \"Subalpine fir\", position = tm_pos_in(\"left\", \"bottom\")),\n    col_alpha=1) +\n  tm_shape(bnd) + tm_polygons(fill_alpha=0, col=\"black\", lwd=2) +\n  tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,\n    fill.legend = tm_legend(title = \"Subalpine Fir\", position = tm_pos_in(\"right\", \"top\"))) +\n  tm_layout(legend.text.size = 0.8)\n\n\n\n\n\n\n\n\nWe can clearly see that most of the absences are located in areas with lower predicted probability of occurrences, while most the presences are in the greener areas."
  },
  {
    "objectID": "tutorials/occurrence.html#evaluate-model",
    "href": "tutorials/occurrence.html#evaluate-model",
    "title": "Species distribution modelling",
    "section": "Evaluate model",
    "text": "Evaluate model\nAn important step in statistical modelling is to evaluate the accuracy of the models. Ideally, we would use spatially and temporally independent data. However, this is rarely possible or affordable. Instead, we can use our hold-out or testing dataset to evaluate the predictive accuracy of our model. The code below creates a data frame from the observed and predicted data that will be used to calculate and plot a measure of predicted accuracy known as the Area under the receiver operating characteristics (ROC) curve. We can ignore the code for now.\n\nabla_pred &lt;- predict(abla_mod, \n                     newdata = abla_val,\n                     type = \"response\")\nabla_predobs &lt;- prediction(abla_pred, abla_val$abla)\nabla_roc = performance(abla_predobs, \n                       measure = \"tpr\", \n                       x.measure = \"fpr\")\nabla_fpr &lt;- slot(abla_roc, \"x.values\")[[1]]\nabla_tpr &lt;- slot(abla_roc, \"y.values\")[[1]]\nabla_aucplot &lt;- data.frame(abla_fpr, abla_tpr)\n\n\nArea under the receiver operating characteristics (ROC) curve\nArea under the receiver operating characteristics (ROC) curve for predictions of subalpine fir occurrence based on WorldClim bioclimatic indices. We now use the table of observed and predicted observations to plot the ROC curve. If our model had no predictive capability, the curve would be a diagonal straight line. Curves that increasingly concave indicate higher accuracy.\n\nggplot(data = abla_aucplot) +\n  geom_line(aes(x = abla_fpr,\n                y = abla_tpr),\n            col = \"red\") +\n  labs(x = \"False Positive Rate\", \n       y = \"True Positive Rate\") +\n  geom_abline(slope = 1, intercept = 0) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()\n\n\n\n\n\n\n\n\n\n\nROC value\nValues for the ROC curve range from 0 to 1, with values of 1 indicating perfect accuracy. Values of 0.5 indicate a random model, no better than the mean value of the occurrence data.\n\nabla_aucval &lt;- performance(abla_predobs, measure = \"auc\")\nslot(abla_aucval, \"y.values\")[[1]]\n\n[1] 0.9031249\n\n\n\n\nOther accuracy measures (optional)\nSeveral other accuracy measures can be used, including overall accuracy, true positive rate, and true negative rate and are shown in the graph. These can be calculated using the performance function. We won’t go into these other than to mention that we can use the results to suggest a cutoff value that would be effective for classifying presence or absence based on the predictions. For example, based on these plots, we could use a cutoff value around 0.56.\n\nabla_all = performance(abla_predobs, \n                       measure = \"acc\")\nabla_pos = performance(abla_predobs, \n                       measure = \"tpr\")\nabla_neg = performance(abla_predobs, \n                       measure = \"tnr\")\ncutoff &lt;- slot(abla_all, \"x.values\")[[1]]\ntotacc &lt;- slot(abla_all, \"y.values\")[[1]]\nposacc &lt;- slot(abla_pos, \"y.values\")[[1]]\nnegacc &lt;- slot(abla_neg, \"y.values\")[[1]]\nabla_accplot &lt;- data.frame(cutoff,\n                           totacc,\n                           posacc,\n                           negacc) |&gt;\n  pivot_longer(cols = one_of(\"totacc\", \n                             \"posacc\", \n                             \"negacc\"),\n               values_to = \"accval\",\n               names_to = \"accstat\")\n\n\nggplot(data = abla_accplot) +\n  geom_line(aes(x = cutoff, \n                y = accval,\n                col = accstat)) +\n    labs(x = \"Classification Cutoff\", \n         y = \"Classification Accuracy\",\n         color = \"Accuracy Statistic\") +\n  scale_color_discrete(labels = c(\"True Negative Rate\",\n                                 \"True Positive Rate\",\n                                 \"Overall Accuracy\")) +\n  scale_x_continuous(expand = c(0.005, 0)) +\n  scale_y_continuous(expand = c(0.005, 0)) +\n  coord_fixed() +\n  theme_bw()"
  },
  {
    "objectID": "tutorials/occurrence.html#read-and-rename-raster-layers-1",
    "href": "tutorials/occurrence.html#read-and-rename-raster-layers-1",
    "title": "Species distribution modelling",
    "section": "Read and rename raster layers",
    "text": "Read and rename raster layers\nOnce downloaded, we rename the 19 rasters to bio1-bio19.\n\npbio &lt;- rast('../data_raw/wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080.tif')\nnames(pbio)\n\n [1] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_1\" \n [2] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_2\" \n [3] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_3\" \n [4] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_4\" \n [5] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_5\" \n [6] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_6\" \n [7] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_7\" \n [8] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_8\" \n [9] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_9\" \n[10] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_10\"\n[11] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_11\"\n[12] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_12\"\n[13] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_13\"\n[14] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_14\"\n[15] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_15\"\n[16] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_16\"\n[17] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_17\"\n[18] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_18\"\n[19] \"wc2.1_30s_bioc_MPI-ESM1-2-HR_ssp245_2061-2080_19\"\n\nnames(pbio) &lt;- paste0(\"bio\", 1:19)\nnames(pbio)\n\n [1] \"bio1\"  \"bio2\"  \"bio3\"  \"bio4\"  \"bio5\"  \"bio6\"  \"bio7\"  \"bio8\"  \"bio9\" \n[10] \"bio10\" \"bio11\" \"bio12\" \"bio13\" \"bio14\" \"bio15\" \"bio16\" \"bio17\" \"bio18\"\n[19] \"bio19\""
  },
  {
    "objectID": "tutorials/occurrence.html#clip-covariates-to-study-area-1",
    "href": "tutorials/occurrence.html#clip-covariates-to-study-area-1",
    "title": "Species distribution modelling",
    "section": "Clip covariates to study area",
    "text": "Clip covariates to study area\nNow we can use the KDTT study area boundary to clip the bioclimate rasters and then merge them.\n\npbio_crop &lt;- crop(pbio, vect(bnd))\nbio_proj &lt;- mask(pbio_crop, vect(bnd))\nwriteRaster(bio_proj, 'data/bio_proj.tif', overwrite=TRUE)"
  },
  {
    "objectID": "tips/species_data.html",
    "href": "tips/species_data.html",
    "title": "Acquiring Species Data",
    "section": "",
    "text": "Objectives:\nPotential sources to explore:"
  },
  {
    "objectID": "tips/species_data.html#gbif",
    "href": "tips/species_data.html#gbif",
    "title": "Acquiring Species Data",
    "section": "GBIF",
    "text": "GBIF\nFrom their website: GBIF - the Global Biodiversity Information Facility - is an international network and data infrastructure funded by the world’s governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth.\n\nView density map of occurrences across Canada\nR package: rgbif\n\n\nStudy area\nOur example study area is the Kaska Dene Traditional Territory that spans southeast Yukon and northcentral BC. We use the st_read function from the sf package to read the boundary layer from a geopackage file called kdtt.gpkg. We then use the generic plot function to view our study area boundary.\n\nbnd &lt;- st_read('../tutorials/data/kdtt.gpkg', 'bnd', quiet=TRUE)"
  },
  {
    "objectID": "tips/species_data.html#moose",
    "href": "tips/species_data.html#moose",
    "title": "Acquiring Species Data",
    "section": "Moose",
    "text": "Moose\nWe will try to acquire existing moose location data. Sources of species distribution data include the Global Biodiversity Information Facility (GBIF). The geodata includes a function to download data from GBIF. The comments in the code below describe the steps to download the data.\n\n# Specify genus and species for species of interest (e.g., alces alces for moose)\ngenus = 'alces'\nspecies = 'alces'\n\n# Download GBIF data and convert to sf point object\ng &lt;- sp_occurrence(genus, species, geo=TRUE, end=2500)\n\n2500 records found\n\n\n0-300-600-900-1200-1500-1800-2100-2400-2500\n2500 records downloaded\n\n# Select a subset of attributes and convert to an sf object\nalal &lt;- select(g, lon, lat, year) |&gt;\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs=4326) |&gt;\n  st_transform(3578)\ncat('Number of observations: ',nrow(alal),'\\n')\n\nNumber of observations:  2500 \n\n\n\nMap downloaded points\nNow we can view our downloaded data.\n\nmapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(alal, cex=2, col='red', col.regions='red', legend=NULL)"
  },
  {
    "objectID": "tips/species_data.html#caribou",
    "href": "tips/species_data.html#caribou",
    "title": "Acquiring Species Data",
    "section": "Caribou",
    "text": "Caribou\n\nrata &lt;- sp_occurrence('rangifer','tarandus', geo=TRUE, end=2500) |&gt;\n  select(lon, lat, year) |&gt;\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs=4326) |&gt;\n  st_transform(3578)\ncat('Number of observations: ',nrow(rata),'\\n')\n\nNumber of observations:  2500 \n\nmapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(rata, cex=2, col='red', col.regions='red', legend=NULL)"
  },
  {
    "objectID": "tips/species_data.html#wolverine",
    "href": "tips/species_data.html#wolverine",
    "title": "Acquiring Species Data",
    "section": "Wolverine",
    "text": "Wolverine\n\ngugu &lt;- sp_occurrence('gulo','gulo', geo=TRUE, end=2500) |&gt;\n  select(lon, lat, year) |&gt;\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs=4326) |&gt;\n  st_transform(3578)\ncat('Number of observations: ',nrow(gugu),'\\n')\n\nNumber of observations:  2500 \n\nmapview(bnd, alpha.regions=0, lwd=1) + \n  mapview(gugu, cex=2, col='red', col.regions='red', legend=NULL)"
  }
]