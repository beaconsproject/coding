#| message: FALSE
#| warning: FALSE
library(sf)
library(tmap)
library(ROCR)
library(dismo)
library(terra)
library(ggplot2)
library(tmaptools)
library(tidyverse)
#| message: FALSE
#| warning: FALSE
bnd <- st_read('data/kdtt.gpkg', 'bnd', quiet=TRUE)
bio <- rast('data/bio.tif')
abla <- st_read('data/kdtt.gpkg', 'abla', quiet=TRUE) %>%
st_transform(4326)
abla_bio <- terra::extract(bio, abla) %>%
bind_cols(abla) %>%
mutate(PresenceAbsence=NULL) %>%
rename(abla=Occurrence) %>%
as.data.frame()
names(abla_bio)
head(abla_bio)
#| message: FALSE
#| warning: FALSE
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(bio[["bio13"]]) + tm_raster(col.scale=tm_scale_intervals(n=5, style="pretty", values="Blues"),
col.legend = tm_legend(title = "Precipitation (mm)", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
set.seed(123)
abla_train <- abla_bio %>%
sample_frac(size = 0.7)
cat("Training data (70%):\n")
table(abla_train$abla)
abla_val <- abla_bio %>%
anti_join(abla_train, by = "ID")
cat("\n\nTesting data (30%):\n")
table(abla_val$abla)
#| message: FALSE
#| warning: FALSE
abla_mod <- gbm.step(data = abla_train, # data used to train model
gbm.x = 2:20, # predictor variables
gbm.y = 21, # response variable
family = "bernoulli", # bernoulli is appropriate for occurrence data
tree.complexity = 3,
learning.rate = 0.01,
bag.fraction = 0.5,
plot.main = FALSE,
verbose = FALSE,
silent = TRUE)
abla_imp <- summary(abla_mod, plotit = FALSE)
cat('Relative importance of bioclimatic variables:\n')
abla_imp
#| message: FALSE
#| warning: FALSE
gbm.plot(abla_mod,
n.plots = 4,
write.title = FALSE,
plot.layout = c(2, 2))
#| message: FALSE
#| warning: FALSE
abla_cur <- predict(object = bio, # bioclimatic variables
model = abla_mod, # model
type = "response",
na.rm = TRUE)
abla_cur
summary(abla_cur)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style="quantile", values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur) + tm_raster(col.scale=tm_scale_intervals(n=5, style="quantile", values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
abla_pred <- predict(abla_mod,
newdata = abla_val,
type = "response")
abla_predobs <- prediction(abla_pred, abla_val$abla)
abla_roc = performance(abla_predobs,
measure = "tpr",
x.measure = "fpr")
abla_fpr <- slot(abla_roc, "x.values")[[1]]
abla_tpr <- slot(abla_roc, "y.values")[[1]]
abla_aucplot <- data.frame(abla_fpr, abla_tpr)
#| message: FALSE
#| warning: FALSE
ggplot(data = abla_aucplot) +
geom_line(aes(x = abla_fpr,
y = abla_tpr),
col = "red") +
labs(x = "False Positive Rate",
y = "True Positive Rate") +
geom_abline(slope = 1, intercept = 0) +
scale_x_continuous(expand = c(0.005, 0)) +
scale_y_continuous(expand = c(0.005, 0)) +
coord_fixed() +
theme_bw()
#| message: FALSE
#| warning: FALSE
abla_aucval <- performance(abla_predobs, measure = "auc")
slot(abla_aucval, "y.values")[[1]]
#| message: FALSE
#| warning: FALSE
abla_all = performance(abla_predobs,
measure = "acc")
abla_pos = performance(abla_predobs,
measure = "tpr")
abla_neg = performance(abla_predobs,
measure = "tnr")
cutoff <- slot(abla_all, "x.values")[[1]]
totacc <- slot(abla_all, "y.values")[[1]]
posacc <- slot(abla_pos, "y.values")[[1]]
negacc <- slot(abla_neg, "y.values")[[1]]
abla_accplot <- data.frame(cutoff,
totacc,
posacc,
negacc) %>%
pivot_longer(cols = one_of("totacc",
"posacc",
"negacc"),
values_to = "accval",
names_to = "accstat")
ggplot(data = abla_accplot) +
geom_line(aes(x = cutoff,
y = accval,
col = accstat)) +
labs(x = "Classification Cutoff",
y = "Classification Accuracy",
color = "Accuracy Statistic") +
scale_color_discrete(labels = c("True Negative Rate",
"True Positive Rate",
"Overall Accuracy")) +
scale_x_continuous(expand = c(0.005, 0)) +
scale_y_continuous(expand = c(0.005, 0)) +
coord_fixed() +
theme_bw()
?classify
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 0.56:1, 1)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 0.56:1, 1, 0)
plot(abla_cur_01)
abla_cur
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 0.56:1, 1)
abla_cur_01 <- subst(abla_cur_01, 0:0.56, 0)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 01:10, 1)
#abla_cur_01 <- subst(abla_cur_01, 0:0.56, 0)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 01:10, 1)
#abla_cur_01 <- subst(abla_cur_01, 0:0.56, 0)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
abla_cur_01 <- subst(abla_cur, 0.1:10, 1)
#abla_cur_01 <- subst(abla_cur_01, 0:0.56, 0)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
m <- c(0, 0.56, 0,
0.56, 1, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
abla_cur_01 <- classify(abla_cu, rclmat)
#| message: FALSE
#| warning: FALSE
m <- c(0, 0.56, 0,
0.56, 1, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
abla_cur_01 <- classify(abla_cur, rclmat)
#abla_cur_01 <- subst(abla_cur, 0.1:10, 1)
#abla_cur_01 <- subst(abla_cur_01, 0:0.56, 0)
plot(abla_cur_01)
#| message: FALSE
#| warning: FALSE
m <- c(0, 0.56, 0,
0.56, 1, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
abla_cur_01 <- classify(abla_cur, rclmat)
plot(abla_cur_01)
plot(abla, add=T)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=5, style="quantile", values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_bivariate(),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
?tm_scale_bivariate
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals()) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_discrete(),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_discrete(values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) #+
#tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
#  fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
#tm_layout(legend.text.size = 0.8)
?mfrow
??mfrow
?par
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
par(mfrow = c(1, 2))
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) #+
#tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
#  fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
#tm_layout(legend.text.size = 0.8)
#tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
#    col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
#    col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla) + tm_dots(fill='PresenceAbsence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
par(mfrow=c(1,1))
#| message: FALSE
#| warning: FALSE
abla1 <- subst(abla, 0, NA)
abla
#| message: FALSE
#| warning: FALSE
abla1 <- mutate(abla, Presence=ifelse(Occurrence, 0, NA, Occurrence)
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#| message: FALSE
#| warning: FALSE
abla1 <- mutate(abla, Presence=ifelse(Occurrence, 0, NA, Occurrence))
names(abla)
abla1 <- mutate(abla, Presence=ifelse(Occurrence, 0, NA, 1))
abla1 <- mutate(abla, Presence=1)
?ifelse
abla1 <- mutate(abla, Presence=ifelse(Occurrence==0, 0, NA, 1))
abla1 <- mutate(abla, Presence=ifelse(Occurrence=0, 0, NA, 1))
abla1 <- mutate(abla, Presence=ifelse(Occurrence=0, 0, NA))
abla1 <- mutate(abla, Presence=ifelse(Occurrence==1, 1, NA))
#| message: FALSE
#| warning: FALSE
abla1 <- mutate(abla, Presence=ifelse(Occurrence==1, 1, NA))
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) #+
tm_shape(abla1) + tm_dots(fill='Presence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
#| message: FALSE
#| warning: FALSE
abla1 <- mutate(abla, Presence=ifelse(Occurrence==1, 1, NA))
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
#tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2) +
tm_shape(abla1) + tm_dots(fill='Presence', size=0.2,
fill.legend = tm_legend(title = "Subalpine Fir", position = tm_pos_in("right", "top"))) +
tm_layout(legend.text.size = 0.8)
table(abla1$Presence)
table(abla1$PresenceAbsence)
#| message: FALSE
#| warning: FALSE
pal <- get_brewer_pal("YlGn", n=5, plot=FALSE)
tm_basemap(server = c("Esri.WorldTopoMap")) +
tm_shape(abla_cur_01) + tm_raster(col.scale=tm_scale_intervals(n=2, values=pal),
col.legend = tm_legend(title = "Subalpine fir", position = tm_pos_in("left", "bottom")),
col_alpha=1) +
tm_shape(bnd) + tm_polygons(fill_alpha=0, col="black", lwd=2)
